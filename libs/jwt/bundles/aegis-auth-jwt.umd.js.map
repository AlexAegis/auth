{"version":3,"file":"aegis-auth-jwt.umd.js","sources":["../../../../libs/jwt/src/lib/function/is-unix-timestamp-expired.function.ts","../../../../libs/jwt/src/lib/model/header-configuration.interface.ts","../../../../libs/jwt/src/lib/model/auth-core-configuration.interface.ts","../../../../node_modules/tslib/tslib.es6.js","../../../../libs/jwt/src/lib/errors/jwt-error.class.ts","../../../../libs/jwt/src/lib/function/is-not-nullish.predicate.ts","../../../../libs/jwt/src/lib/function/string.predicate.ts","../../../../libs/jwt/src/lib/function/handle-jwt-failure.function.ts","../../../../libs/jwt/src/lib/function/handle-jwt-error.function.ts","../../../../libs/jwt/src/lib/function/function.predicate.ts","../../../../libs/jwt/src/lib/function/promise.predicate.ts","../../../../libs/jwt/src/lib/function/into-observable.function.ts","../../../../libs/jwt/src/lib/function/is-timestamp-expired-now-and-when-it-is.function.ts","../../../../libs/jwt/src/lib/function/is-unix-timestamp-expired-now-and-when-it-is.function.ts","../../../../libs/jwt/src/lib/function/check-against-http-error-filter.function.ts","../../../../libs/jwt/src/lib/function/call-when-function.function.ts","../../../../libs/jwt/src/lib/function/http-response.predicate.ts","../../../../libs/jwt/src/lib/function/do-jwt-refresh.function.ts","../../../../libs/jwt/src/lib/function/try-jwt-refresh.function.ts","../../../../libs/jwt/src/lib/function/base64-decoder.function.ts","../../../../libs/jwt/src/lib/model/jwt-token.class.ts","../../../../libs/jwt/src/lib/token/jwt-configuration.token.ts","../../../../libs/jwt/src/lib/service/jwt-token.service.ts","../../../../libs/jwt/src/lib/guards/login.guard.ts","../../../../libs/jwt/src/lib/interceptor/jwt-error-handling.interceptor.ts","../../../../libs/jwt/src/lib/function/match-against.function.ts","../../../../libs/jwt/src/lib/function/check-against-url-filter.function.ts","../../../../libs/jwt/src/lib/function/separate-url.function.ts","../../../../libs/jwt/src/lib/interceptor/jwt-injector.interceptor.ts","../../../../libs/jwt/src/lib/interceptor/jwt-refresh.interceptor.ts","../../../../libs/jwt/src/lib/jwt.module.ts","../../../../libs/jwt/src/lib/model/http-method.enum.ts","../../../../libs/jwt/src/aegis-auth-jwt.ts"],"sourcesContent":["/**\n *\n * @param unixTimestamp seconds from the unix epoch 1970-01-01T00:00:00Z\n * if not supplied it will always be expired\n */\nexport function isUnixTimestampExpired(unixTimestamp = -Infinity): boolean {\n\treturn unixTimestamp < Math.floor(new Date().getTime() / 1000);\n}\n","import { BehaviorSubject, Observable } from 'rxjs';\n\nexport const DEFAULT_HEADER_CONFIG: Partial<HeaderConfiguration> = {\n\tgetValue: new BehaviorSubject<string | null | undefined>(null),\n};\n\nexport interface NormalizedHeaderConfiguration extends HeaderConfiguration {\n\tvalue$: Observable<string | null | undefined>;\n}\n\n/**\n * Token injection configuration\n *\n * The optional generic defined the refresh endpoints Response type. If you\n * are not using that feature there's no need to define it.\n *\n * Example configuration:\n * ```typescript\n * AuthCoreModule.forRoot<TokenStorageService>({\n *\t\tuseFactory: (service: TokenStorageService) => ({\n *\t\t\tgetToken: service.accessToken$\n *\t\t\tautoRefresher: {\n * \t\t\t\tendpoint: `${environment.api}/auth/refresh`,\n * \t\t\t\tsetToken: (response) => service.accessToken$.next(response.accessToken)\n * \t\t\t}\n *\t\t}),\n *\t\tdeps: [TokenStorageService],\n * })\n * ```\n */\nexport interface HeaderConfiguration extends UrlFilter {\n\t/**\n\t * A callback or observable that will be called or subscribed to\n\t * on every http request and returns a value for the header\n\t *\n\t * @example getValue: () => localstorage.get('foo')\n\t * @example getValue: myTokenService.foo$\n\t */\n\tgetValue:\n\t\t| Observable<string | null | undefined>\n\t\t| (() =>\n\t\t\t\t| string\n\t\t\t\t| null\n\t\t\t\t| undefined\n\t\t\t\t| Promise<string | null | undefined>\n\t\t\t\t| Observable<string | null | undefined>);\n\n\t/**\n\t * Header name to be set\n\t */\n\theader: string;\n}\n\nexport interface UrlFilter {\n\t/**\n\t * These domains won't recieve this header even if they are listed in the\n\t * whitelist.\n\t *\n\t * If `null` or `undefined`, this category of rules won't take any effect.\n\t * If empty, it would mean \"No domains are blacklisted\", and it won't\n\t * take any effect.\n\t *\n\t * @default undefined\n\t * @example ['localhost:3333']\n\t * @example [/localhost:[0-9]{4}/]\n\t */\n\tdomainBlacklist?: (string | RegExp)[];\n\n\t/**\n\t * Only domains listed will be recieving header injections\n\t *\n\t * If `null` or `undefined`, this category of rules won't take any effect.\n\t * If empty, it would mean \"No domains are whitelisted\", so no paths would\n\t * recieve tokens!\n\t *\n\t * @default undefined\n\t * @example ['localhost:3333']\n\t * @example [/localhost:[0-9]{4}/]\n\t */\n\tdomainWhitelist?: (string | RegExp)[];\n\n\t/**\n\t * These paths won't recieve this header even if they are listed in the\n\t * whitelist.\n\t *\n\t * If `null` or `undefined`, this category of rules won't take any effect.\n\t * If empty, it would mean \"No paths are blacklisted\", and it won't\n\t * take any effect.\n\t *\n\t * @default undefined\n\t * @example ['api/v2/users/1']\n\t * @example [/users\\/.+/]\n\t */\n\tpathBlacklist?: (string | RegExp)[];\n\n\t/**\n\t * Only paths listed will be recieving this header injection.\n\t *\n\t * If `null` or `undefined`, this category of rules won't take any effect.\n\t * If empty, it would mean \"No paths are whitelisted\", so no paths would\n\t * recieve tokens!\n\t *\n\t * @default undefined\n\t * @example ['api/v2/users/1']\n\t * @example [/users\\/.+/]\n\t */\n\tpathWhitelist?: (string | RegExp)[];\n\n\t/**\n\t * These protocols won't recieve this header even if they are listed in\n\t * the whitelist.\n\t *\n\t * If `null` or `undefined`, this category of rules won't take any effect.\n\t * If empty, it would mean \"No protocols are blacklisted\", and it won't\n\t * take any effect.\n\t *\n\t * @default undefined\n\t * @example ['http']\n\t * @example [/https?/]\n\t */\n\tprotocolBlacklist?: (string | RegExp)[];\n\n\t/**\n\t * Only protocols listed will be recieving this header injections.\n\t *\n\t * If empty or undefined, this category of rules won't take any effect.\n\t * If empty, it would mean \"No protocols are whitelisted\", so no protocols\n\t * would recieve tokens!\n\t *\n\t * @default undefined\n\t * @example ['http']\n\t * @example [/https?/]\n\t */\n\tprotocolWhitelist?: (string | RegExp)[];\n}\n","import { HttpHeaders, HttpParams } from '@angular/common/http';\nimport { Params } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { JwtCannotRefreshError, JwtCouldntRefreshError, JwtError } from '../errors/jwt-error.class';\nimport {\n\tDEFAULT_HEADER_CONFIG,\n\tHeaderConfiguration,\n\tUrlFilter,\n} from '../model/header-configuration.interface';\nimport { HttpMethodType } from './http-method.enum';\n\nexport const DEFAULT_JWT_HEADER = 'Authorization';\nexport const DEFAULT_JWT_SCHEME = 'Bearer ';\n\nexport const DEFAULT_JWT_CONFIG: Partial<JwtConfiguration> = {\n\t...DEFAULT_HEADER_CONFIG,\n\theader: DEFAULT_JWT_HEADER,\n\tscheme: DEFAULT_JWT_SCHEME,\n\thandleWithCredentials: true,\n};\n\nexport const DEFAULT_JWT_REFRESH_CONFIG_DEFAULT_AUTO_IN_GUARD = true;\n\nexport const DEFAULT_JWT_REFRESH_CONFIG: Partial<JwtRefreshConfiguration<unknown, unknown>> = {\n\tmethod: 'POST',\n\terrorCodeWhitelist: [401],\n\tisAutoRefreshAllowedInLoginGuardByDefault: DEFAULT_JWT_REFRESH_CONFIG_DEFAULT_AUTO_IN_GUARD,\n};\n\nexport interface JwtRefreshResponse {\n\taccessToken: string;\n\trefreshToken?: string;\n}\n\nexport interface HttpRequestInit {\n\theaders?: HttpHeaders;\n\treportProgress?: boolean;\n\tparams?: HttpParams;\n\tresponseType?: 'arraybuffer' | 'blob' | 'json' | 'text';\n\twithCredentials?: boolean;\n}\n\n/**\n * TODO: optional generic matcher function\n */\nexport interface HttpErrorFilter {\n\t/**\n\t * The error codes on which an act is allowed to happen,\n\t * an empty array means it can't act on anything\n\t *\n\t * @default [401]\n\t */\n\terrorCodeWhitelist?: number[];\n\n\t/**\n\t * The error codes on which an act is not allowed to happen,\n\t * an empty array (and if undefined) means it can always try a single\n\t * act in case of an error\n\t *\n\t * @default undefined\n\t */\n\terrorCodeBlacklist?: number[];\n}\n\n/**\n * Enables the RefreshInterceptor which will automatically tries to\n * refresh the accessToken on expiration or failure of the next request.\n *\n * Because handling refreshes is not standardized, instead of asking for the\n * refresh token directly I ask you to provide the request itself, however you\n * like to. In these callbacks you can access your refreshToken wherever you\n * store it.\n *\n * You can still configure a `getRefreshToken` property but it's optional,\n * not used in the interceptor at all, and is only used in the helper service.\n * If you do not with to interact with the parsed refreshToken (Usually you\n * don't need to) you can leave that out. But it's there if you might need it.\n *\n * The reason it's configured through multiple properties instead of a callback\n * where I let you do the refresh request however you see fit is to make sure the\n * refreshUrl is known to avoid potentional infinite requests when hitting the\n * refresh endpoint. This way you don't have to remember setting this into the\n * url filter manually.\n *\n * @example configuration.\n * AuthCoreModule.forRoot<TokenStorageService>({\n *\t\tuseFactory: (service: TokenStorageService) => ({\n *\t\t\tgetToken: service.accessToken$\n *\t\t\tautoRefresher: {\n * \t\t\t\tendpoint: `${environment.api}/auth/refresh`,\n * \t\t\t\tsetToken: (response) => service.accessToken$.next(response.accessToken)\n * \t\t\t}\n *\t\t}),\n *\t\tdeps: [TokenStorageService],\n * })\n *\n * @default undefined\n */\nexport interface JwtRefreshConfiguration<RefreshRequest, RefreshResponse>\n\textends UrlFilter,\n\t\tHttpErrorFilter {\n\t/**\n\t * After a successful refresh, this callback will be called.\n\t * You need to define a function which will save the the token in a way\n\t * that if the interceptor calls `getToken` again, it will get the token\n\t * saved with this method.\n\t *\n\t * @example using `localStorage`\n\t * \t\tsetToken: (response) => localStorage.setItem('accessToken', response.accessToken)\n\t * @example using a service.\n\t *\n\t * ```typescript\n\t * AuthCoreModule.forRoot<TokenStorageService>({\n\t *\t\tuseFactory: (service: TokenStorageService) => ({\n\t *\t\t\tgetToken: service.accessToken$\n\t *\t\t\tautoRefresher: {\n\t * \t\t\t\tendpoint: `${environment.api}/auth/refresh`,\n\t * \t\t\t\tsetRefreshToken: (response) => service.accessToken$.next(response.accessToken)\n\t * \t\t\t}\n\t *\t\t}),\n\t *\t\tdeps: [TokenStorageService],\n\t * })\n\t * ```\n\t *\n\t */\n\tsetRefreshedTokens: (response: JwtRefreshResponse) => void;\n\n\t/**\n\t * The method for the request, usually it's a POST so that's the default\n\t *\n\t * @default 'POST'\n\t */\n\tmethod?: HttpMethodType;\n\n\t/**\n\t * The endpoint that will be requested for a new token\n\t */\n\trefreshUrl: string;\n\n\t/**\n\t * A callback or observable that can be used to retrieve the body of the\n\t * request. If it's null or undefined, the refresh won't be executed. This\n\t * can be utilized to not do a refresh on a logged out state.\n\t *\n\t * @example getValue: () => localstorage.get('foo')\n\t * @example getValue: myTokenService.foo$\n\t */\n\tcreateRefreshRequestBody:\n\t\t| Observable<RefreshRequest | null | undefined>\n\t\t| (() =>\n\t\t\t\t| RefreshRequest\n\t\t\t\t| null\n\t\t\t\t| undefined\n\t\t\t\t| Promise<RefreshRequest | null | undefined>\n\t\t\t\t| Observable<RefreshRequest | null | undefined>);\n\n\t/**\n\t * A callback that should return the defaults on the request\n\t */\n\trefreshRequestInitials?: (() => HttpRequestInit | undefined) | HttpRequestInit;\n\n\t/**\n\t * This function have to transform the result of your refresh endpoint\n\t * into a digestable form. It will be called after successful refreshes.\n\t */\n\ttransformRefreshResponse: (response: RefreshResponse) => JwtRefreshResponse;\n\n\t/**\n\t * This callback is called when a refresh either failed or cannot be done.\n\t * This marks the point where both tokens are invalid and the user needs to\n\t * relog. Because this is usually done through a login page, aside from a\n\t * regular callback, a string can also be supplied which will act as the\n\t * target of navigation. Check `onFailureRedirectParameters` if you wish\n\t * to supply query parameters. For more advanced usage, consider\n\t * implementing it as a custom function, the error object is available\n\t * there too!\n\t */\n\tonFailure?: string | ((error: JwtCouldntRefreshError | JwtCannotRefreshError) => void);\n\n\tonFailureRedirectParameters?:\n\t\t| ((error: JwtCouldntRefreshError | JwtCannotRefreshError) => HttpParams | Params)\n\t\t| HttpParams\n\t\t| Params;\n\n\t/**\n\t * Optional!\n\t *\n\t * The refresh mechanic only uses this to determine if it's expired or not\n\t * and so potentionally saving a request that would fail anyway. It is\n\t * also used in the helper service if you with to interact with the\n\t * parsed refreshToken throught the helper observables. If you do not\n\t * need either of these, you don't have to implement this.\n\t *\n\t * A callback or observable that can be used to retrieve the refresh token\n\t * Not used in the interceptor!\n\t *\n\t * @example getValue: () => localstorage.get('foo')\n\t * @example getValue: myTokenService.foo$\n\t */\n\tgetRefreshToken?:\n\t\t| Observable<string | null | undefined>\n\t\t| (() =>\n\t\t\t\t| string\n\t\t\t\t| null\n\t\t\t\t| undefined\n\t\t\t\t| Promise<string | null | undefined>\n\t\t\t\t| Observable<string | null | undefined>);\n\n\t/**\n\t * When using the LoginGuard this setting will determine the default\n\t * value. So instead of disabling the autoRefresh behavior on every\n\t * route with the data option, or writing your own guard (Which would\n\t * be really simple) just set this to false. You can still override it\n\t * using route data.\n\t *\n\t * See the LoginGuardData helper interface to see what it can utilize.\n\t *\n\t * @default true\n\t */\n\tisAutoRefreshAllowedInLoginGuardByDefault?: boolean;\n}\n\n/**\n * This is a helper interface because they look the same on both\n * `JwtConfiguration` and `JwtRefreshConfiguration`. They are re-defined\n * on them to provide better documentation.\n *\n * In the case where you wish to implement them both in a separate object\n * then spread it back to both to reduce code-duplication, this type can\n * be utilized.\n */\nexport interface JwtErrorHandling {\n\t/**\n\t * If it's a string, instead of calling it, a redirection will happen,\n\t * with `onFailureRedirectParameters` as it's queryParams.\n\t */\n\tonFailure?:\n\t\t| string\n\t\t| ((jwtError: JwtError | JwtCouldntRefreshError | JwtCannotRefreshError) => void);\n\n\t/**\n\t * This option is only used when the `onFailure` option is a string\n\t * so it's handled as a redirect. When this happens, you can define\n\t * the queryparams to be used with this redirect.\n\t *\n\t * When implemented as a function, the JwtError will be forwarded to it.\n\t * All JwtErrors have the `originalRequest` available in them, so it's\n\t * trivial to acquire the failed url.\n\t */\n\tonFailureRedirectParameters?:\n\t\t| ((\n\t\t\t\terror: JwtError | JwtCouldntRefreshError | JwtCannotRefreshError\n\t\t  ) => HttpParams | Params)\n\t\t| HttpParams\n\t\t| Params;\n}\n\n/**\n * Token injection configuration\n *\n * The optional generic defined the refresh endpoints Response type. If you\n * are not using that feature there's no need to define it.\n *\n * Example configuration:\n * ```typescript\n * AuthCoreModule.forRoot<TokenStorageService>({\n *\t\tuseFactory: (service: TokenStorageService) => ({\n *\t\t\tgetToken: service.accessToken$\n *\t\t\tautoRefresher: {\n * \t\t\t\tendpoint: `${environment.api}/auth/refresh`,\n * \t\t\t\tsetToken: (response) => service.accessToken$.next(response.accessToken)\n * \t\t\t}\n *\t\t}),\n *\t\tdeps: [TokenStorageService],\n * })\n * ```\n */\nexport interface JwtConfiguration extends Omit<HeaderConfiguration, 'getValue'>, JwtErrorHandling {\n\t/**\n\t * A callback or observable that will be called or subscribed to\n\t * on every http request and returns a value for the header\n\t *\n\t * @example getValue: () => localstorage.get('foo')\n\t * @example getValue: myTokenService.foo$\n\t */\n\tgetToken:\n\t\t| Observable<string | null | undefined>\n\t\t| (() =>\n\t\t\t\t| string\n\t\t\t\t| null\n\t\t\t\t| undefined\n\t\t\t\t| Promise<string | null | undefined>\n\t\t\t\t| Observable<string | null | undefined>);\n\n\t/**\n\t * The prefix of the token when injecting. Notice thet the trailing\n\t * whitespace has to be set here\n\t *\n\t * @default 'Bearer '\n\t */\n\tscheme?: string;\n\n\t/**\n\t * Header name to be set\n\t *\n\t * @default 'Authorization'\n\t */\n\theader: string;\n\n\t/**\n\t * Sets the 'withCredentials' to true along with the token\n\t *\n\t * @default true\n\t */\n\thandleWithCredentials: boolean;\n\n\t/**\n\t * This callback is called when the request fails and there is no\n\t * RefreshConfiguration, or when the access token is simply missing.\n\t * `getToken` returned a nullish value. If the RefreshConfiguration is\n\t * available, then the error handling continues in the same fashion on\n\t * the other configuration.\n\t *\n\t * Both have the same names and signature for\n\t * both the error handling configuration options `onFailure` and\n\t * `onFailureRedirectParameters`, so if you wish to use the same for both\n\t * implement them outside, and spread them back. You can use the\n\t * `JwtErrorHandling` interface to help you with the typing. Although\n\t * thats a bit wider when it comes to the error types.\n\t *\n\t * If it's a string, instead of calling it, a redirection will happen,\n\t * with `onFailureRedirectParameters` as it's queryParams.\n\t */\n\tonFailure?: string | ((jwtError: JwtError) => void);\n\n\tonFailureRedirectParameters?: ((error: JwtError) => HttpParams | Params) | HttpParams | Params;\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { HttpErrorResponse, HttpRequest } from '@angular/common/http';\n\nexport class JwtError extends Error {\n\tstatic type = 'JWT_ERROR';\n\n\tpublic constructor(\n\t\tpublic readonly originalRequest: HttpRequest<unknown> | undefined,\n\t\tpublic readonly originalError: unknown,\n\t\tmessage = JwtError.type\n\t) {\n\t\tsuper(message);\n\t}\n\n\tstatic createErrorResponse(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): HttpErrorResponse {\n\t\treturn new HttpErrorResponse({\n\t\t\terror: JwtError.createErrorEvent(request, refreshError),\n\t\t});\n\t}\n\n\tstatic createErrorEvent(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): ErrorEvent {\n\t\treturn new ErrorEvent(JwtError.type, {\n\t\t\terror: new JwtError(request, refreshError),\n\t\t});\n\t}\n}\n\n/**\n * When both access and refresh tokens are either invalid or expired!\n */\nexport class JwtCannotRefreshError extends JwtError {\n\tstatic type = 'JWT_CANNOT_REFRESH_ERROR';\n\n\tpublic constructor(\n\t\tpublic readonly originalRequest: HttpRequest<unknown> | undefined,\n\t\tpublic readonly originalError: unknown\n\t) {\n\t\tsuper(originalRequest, originalError, JwtCannotRefreshError.type);\n\t}\n\n\tstatic createErrorResponse(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): HttpErrorResponse {\n\t\treturn new HttpErrorResponse({\n\t\t\terror: JwtCannotRefreshError.createErrorEvent(request, refreshError),\n\t\t});\n\t}\n\n\tstatic createErrorEvent(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): ErrorEvent {\n\t\treturn new ErrorEvent(JwtCannotRefreshError.type, {\n\t\t\terror: new JwtCannotRefreshError(request, refreshError),\n\t\t});\n\t}\n}\n\n/**\n * When refresh failed\n */\nexport class JwtCouldntRefreshError extends JwtError {\n\tstatic type = 'JWT_COULDNT_REFRESH_ERROR';\n\n\tpublic constructor(\n\t\tpublic readonly originalRequest: HttpRequest<unknown> | undefined,\n\t\tpublic readonly originalError: unknown\n\t) {\n\t\tsuper(originalRequest, originalError, JwtCouldntRefreshError.type);\n\t}\n\n\tstatic createErrorResponse(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): HttpErrorResponse {\n\t\treturn new HttpErrorResponse({\n\t\t\terror: JwtCouldntRefreshError.createErrorEvent(request, refreshError),\n\t\t});\n\t}\n\n\tstatic createErrorEvent(\n\t\trequest: HttpRequest<unknown> | undefined,\n\t\trefreshError: unknown\n\t): ErrorEvent {\n\t\treturn new ErrorEvent(JwtCouldntRefreshError.type, {\n\t\t\terror: new JwtCouldntRefreshError(request, refreshError),\n\t\t});\n\t}\n}\n","export function isNotNullish<T>(t: T | undefined | null): t is T {\n\treturn t !== undefined && t !== null;\n}\n","export function isString(stringLike: unknown): stringLike is string {\n\treturn typeof stringLike === 'string';\n}\n","import { HttpParams } from '@angular/common/http';\nimport { Params, Router } from '@angular/router';\nimport { isString } from '../function/string.predicate';\n\n/**\n * Jwt failures are handled by either calling a callback or if its a string,\n * redirect\n *\n * @internal\n */\nexport function handleJwtFailure<E>(\n\terrorCallbackOrRedirect: string | ((error: E) => void),\n\terror: E,\n\trouter?: Router,\n\tredirectParameters?: ((error: E) => HttpParams | Params) | HttpParams | Params\n): void {\n\tif (isString(errorCallbackOrRedirect)) {\n\t\tif (router) {\n\t\t\tlet queryParams = redirectParameters;\n\t\t\tif (typeof redirectParameters === 'function') {\n\t\t\t\tqueryParams = redirectParameters(error);\n\t\t\t}\n\n\t\t\trouter.navigate([errorCallbackOrRedirect], {\n\t\t\t\tqueryParams,\n\t\t\t});\n\t\t} else {\n\t\t\t// This error is intended to surface as it's a configuration problem\n\t\t\tthrow new Error(\n\t\t\t\t'JWT Refresh configuration error! ' +\n\t\t\t\t\t'`onFailure` is defined as a string, but the ' +\n\t\t\t\t\t'Router is not available! Is @angular/router ' +\n\t\t\t\t\t'installed and the RouterModule imported?'\n\t\t\t);\n\t\t}\n\t} else {\n\t\terrorCallbackOrRedirect(error);\n\t}\n}\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { Observable, throwError } from 'rxjs';\nimport { JwtCannotRefreshError, JwtCouldntRefreshError, JwtError } from '../errors/jwt-error.class';\nimport { isNotNullish } from './is-not-nullish.predicate';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport { handleJwtFailure } from './handle-jwt-failure.function';\n\nexport function handleJwtError<RefreshRequest = unknown, RefreshResponse = unknown>(\n\twrappedError:\n\t\t| (Omit<HttpErrorResponse, 'error'> & {\n\t\t\t\terror?: Omit<ErrorEvent, 'error'> & {\n\t\t\t\t\terror: JwtError | JwtCannotRefreshError | JwtCouldntRefreshError;\n\t\t\t\t};\n\t\t  })\n\t\t| { error?: { error: JwtError | JwtCannotRefreshError | JwtCouldntRefreshError } },\n\tjwtConfiguration: JwtConfiguration,\n\tjwtRefreshConfiguration?: JwtRefreshConfiguration<RefreshRequest, RefreshResponse>,\n\trouter?: Router\n): Observable<never> {\n\tconst error: undefined | JwtError | JwtCannotRefreshError | JwtCouldntRefreshError =\n\t\twrappedError.error?.error;\n\n\tif (error instanceof JwtCannotRefreshError || error instanceof JwtCouldntRefreshError) {\n\t\tif (jwtRefreshConfiguration && isNotNullish(jwtRefreshConfiguration.onFailure)) {\n\t\t\thandleJwtFailure(\n\t\t\t\tjwtRefreshConfiguration.onFailure,\n\t\t\t\terror,\n\t\t\t\trouter,\n\t\t\t\tjwtRefreshConfiguration.onFailureRedirectParameters\n\t\t\t);\n\t\t}\n\t\t// Rethrow the inner error, so observers of the user can see it\n\t\treturn throwError(error);\n\t} else if (error instanceof JwtError) {\n\t\tif (isNotNullish(jwtConfiguration.onFailure)) {\n\t\t\thandleJwtFailure(\n\t\t\t\tjwtConfiguration.onFailure,\n\t\t\t\terror,\n\t\t\t\trouter,\n\t\t\t\tjwtConfiguration.onFailureRedirectParameters\n\t\t\t);\n\t\t}\n\t\treturn throwError(error);\n\t} else {\n\t\t// Other errors are left untreated\n\t\treturn throwError(wrappedError);\n\t}\n}\n","export function isFunction<Return>(funlike: unknown): funlike is () => Return {\n\treturn typeof funlike === 'function';\n}\n","/**\n * Returns true if the object is truthy and has a `then` and a `catch` function.\n * Using `instanceof` would not be sufficient as Promises can be contructed\n * in many ways, and it's just a specification.\n */\nexport function isPromise<T>(promiseLike: unknown): promiseLike is Promise<T> {\n\treturn (\n\t\tpromiseLike &&\n\t\ttypeof (promiseLike as Promise<T>).then === 'function' &&\n\t\ttypeof (promiseLike as Promise<T>).catch === 'function'\n\t);\n}\n","import { from, isObservable, Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { isFunction } from './function.predicate';\nimport { isPromise } from './promise.predicate';\n\n/**\n * Returns a cold observable from a function, or returns an observable if\n * one is directly passed to it\n */\nexport function intoObservable<T>(\n\tgetValue: T | Observable<T> | Promise<T> | (() => T | Promise<T> | Observable<T>)\n): Observable<T> {\n\tif (isObservable(getValue)) {\n\t\treturn getValue;\n\t} else if (isFunction(getValue)) {\n\t\treturn of(null).pipe(\n\t\t\tswitchMap(() => {\n\t\t\t\tconst result = getValue();\n\t\t\t\tif (isObservable(result)) return result;\n\t\t\t\tif (isPromise(result)) return from(result);\n\t\t\t\telse return of(result);\n\t\t\t})\n\t\t);\n\t} else if (isPromise(getValue)) {\n\t\treturn from(getValue);\n\t} else {\n\t\treturn of(getValue);\n\t}\n}\n","import { merge, Observable, of, timer } from 'rxjs';\nimport { mapTo } from 'rxjs/operators';\n\n/**\n * It returns an observable which emits instantly a boolean describing if the\n * timestamp is expired or not. If not, it will emit a second time when it\n * will expire.\n *\n * @param timestamp milliseconds\n */\nexport const isTimestampExpiredNowAndWhenItIs = (timestamp: number): Observable<boolean> => {\n\t// If already expired, just return that\n\tif (timestamp - new Date().getTime() < 0) {\n\t\treturn of(true);\n\t} else {\n\t\t// If not, return that is not and a timer that will emit when it does\n\t\treturn merge(of(false), timer(new Date(timestamp)).pipe(mapTo(true)));\n\t}\n};\n","import { Observable } from 'rxjs';\nimport { isTimestampExpiredNowAndWhenItIs } from './is-timestamp-expired-now-and-when-it-is.function';\n\n/**\n * It returns an observable which emits instantly a boolean describing if the\n * timestamp is expired or not. If not, it will emit a second time when it\n * will expire.\n *\n * @param unixTimestamp seconds from the unix epoch 1970-01-01T00:00:00Z\n * if not supplied it will always be expired\n */\nexport const isUnixTimestampExpiredNowAndWhenItIs = (\n\tunixTimestamp: number\n): Observable<boolean> => {\n\treturn isTimestampExpiredNowAndWhenItIs(Math.floor(unixTimestamp * 1000));\n};\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { HttpErrorFilter } from '../model/auth-core-configuration.interface';\n\n/**\n * Matches the filter against an error response. Non-existend rulesets\n * automatically pass. **Empty whitelist rulesets never pass.** Empty blacklist\n * rulesets always pass.\n */\nexport function checkAgainstHttpErrorFilter(\n\thttpErrorFilter: HttpErrorFilter,\n\terror: HttpErrorResponse\n): boolean {\n\tconst statusMatcher = (code: number) => code === error.status;\n\tconst errorCodeWhitelistRulesPass =\n\t\thttpErrorFilter.errorCodeWhitelist?.some(statusMatcher) ?? true;\n\n\tconst errorCodeBlacklistRulesPass = !httpErrorFilter.errorCodeBlacklist?.some(statusMatcher);\n\n\treturn errorCodeWhitelistRulesPass && errorCodeBlacklistRulesPass;\n}\n","import { isFunction } from './function.predicate';\n\nexport function callWhenFunction<T = unknown>(functionLike: (() => T) | T): T {\n\tlet result;\n\tif (isFunction<T>(functionLike)) {\n\t\tresult = functionLike();\n\t} else {\n\t\tresult = functionLike;\n\t}\n\treturn result;\n}\n","import { HttpEvent, HttpEventType, HttpResponse } from '@angular/common/http';\n\nexport function isHttpResponse<T>(httpEvent: HttpEvent<T>): httpEvent is HttpResponse<T> {\n\treturn httpEvent.type === HttpEventType.Response;\n}\n","import { HttpHandler, HttpRequest } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { catchError, filter, map, mergeMap, tap } from 'rxjs/operators';\nimport {\n\tJwtRefreshConfiguration,\n\tJwtRefreshResponse,\n} from '../model/auth-core-configuration.interface';\nimport { callWhenFunction } from './call-when-function.function';\nimport { isHttpResponse } from './http-response.predicate';\n\nexport function doJwtRefresh<Req, Res, Ret>(\n\tnext: HttpHandler,\n\trequestBody: Req,\n\tjwtRefreshConfiguration: JwtRefreshConfiguration<Req, Res>,\n\tonError: (refreshError: unknown) => Observable<Ret>,\n\toriginalAction: (refreshResponse: JwtRefreshResponse) => Observable<Ret>\n): Observable<Ret> {\n\tconst refreshRequest = new HttpRequest<Req>(\n\t\tjwtRefreshConfiguration.method ?? 'POST',\n\t\tjwtRefreshConfiguration.refreshUrl,\n\t\trequestBody,\n\t\tcallWhenFunction(jwtRefreshConfiguration.refreshRequestInitials)\n\t);\n\n\treturn next.handle(refreshRequest).pipe(\n\t\tfilter(isHttpResponse),\n\t\tmap((response) => jwtRefreshConfiguration.transformRefreshResponse(response.body)),\n\t\ttap((refreshResponse) => jwtRefreshConfiguration.setRefreshedTokens(refreshResponse)),\n\t\tmergeMap((refreshResponse) => originalAction(refreshResponse)),\n\t\tcatchError(onError)\n\t);\n}\n","import { HttpErrorResponse, HttpHandler } from '@angular/common/http';\nimport { Observable, throwError } from 'rxjs';\nimport { switchMap, take } from 'rxjs/operators';\nimport {\n\tJwtRefreshConfiguration,\n\tJwtRefreshResponse,\n} from '../model/auth-core-configuration.interface';\nimport { checkAgainstHttpErrorFilter } from './check-against-http-error-filter.function';\nimport { doJwtRefresh } from './do-jwt-refresh.function';\nimport { intoObservable } from './into-observable.function';\n\nexport function tryJwtRefresh<Req, Res, Ret>(\n\tnext: HttpHandler,\n\toriginalError: string | HttpErrorResponse,\n\tjwtRefreshConfiguration: JwtRefreshConfiguration<Req, Res>,\n\tonError: (refreshError: unknown) => Observable<Ret>,\n\toriginalAction: (refreshResponse: JwtRefreshResponse) => Observable<Ret>\n): Observable<Ret> {\n\tconst isRefreshAllowed =\n\t\ttypeof originalError === 'string' ||\n\t\tcheckAgainstHttpErrorFilter(jwtRefreshConfiguration, originalError);\n\tif (isRefreshAllowed) {\n\t\treturn intoObservable(jwtRefreshConfiguration.createRefreshRequestBody).pipe(\n\t\t\ttake(1),\n\t\t\tswitchMap((requestBody) => {\n\t\t\t\tif (requestBody) {\n\t\t\t\t\treturn doJwtRefresh(\n\t\t\t\t\t\tnext,\n\t\t\t\t\t\trequestBody,\n\t\t\t\t\t\tjwtRefreshConfiguration,\n\t\t\t\t\t\tonError,\n\t\t\t\t\t\toriginalAction\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturn throwError(originalError);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t} else return throwError(originalError);\n}\n","import { Base64 } from 'js-base64';\n\nexport type Base64String = string;\nexport type JsonString = string;\n\n/**\n *\n * @param str json encoded in Base64\n */\nexport const decodeJsonLikeBase64 = <T = Record<string, unknown>>(str: Base64String): T | null => {\n\ttry {\n\t\treturn JSON.parse(Base64.decode(str));\n\t} catch (error) {\n\t\tconsole.error('Invalid Jsonlike Base64 string', error);\n\t\treturn null;\n\t}\n};\n","import { Base64 } from 'js-base64';\nimport { Base64String, decodeJsonLikeBase64 } from '../function/base64-decoder.function';\nimport { isUnixTimestampExpired } from '../function/is-unix-timestamp-expired.function';\n\nexport type JwtTokenString = string;\nexport type UnixTime = number;\n\nexport interface JwtTokenHeader {\n\t/**\n\t * Media type\n\t */\n\ttyp?: string;\n\t/**\n\t * Content Type\n\t */\n\tcty?: 'JWT' | string;\n\t/**\n\t * Algorithm\n\t */\n\talg: string;\n\t/**\n\t * Encryption\n\t */\n\tenc?: string;\n}\n\n/**\n * Registered claim names defined in RFC 7519 are predefined here.\n */\nexport interface JwtTokenPayload {\n\t/**\n\t * Issuer\n\t */\n\tiss?: string;\n\t/**\n\t * Subject\n\t */\n\tsub?: string;\n\t/**\n\t * Audience\n\t */\n\taud?: string;\n\t/**\n\t * Expiration Time\n\t */\n\texp: UnixTime;\n\t/**\n\t * Not Before\n\t */\n\tnbf?: UnixTime;\n\t/**\n\t * Issued at\n\t */\n\tiat?: UnixTime;\n\t/**\n\t * JWT ID\n\t */\n\tjti?: string;\n}\n\n/**\n * Common token pair\n */\nexport interface JwtTokenPair {\n\taccessToken: JwtTokenString;\n\trefreshToken: JwtTokenString;\n}\n\nexport class JwtToken<Claims = Record<string | number, unknown>> {\n\tpublic constructor(\n\t\tpublic header: JwtTokenHeader,\n\t\tpublic payload: JwtTokenPayload & Claims,\n\t\tpublic signature: string\n\t) {}\n\tpublic static JWT_TOKEN_SEPARATOR = '.';\n\n\tpublic static from<Claims = Record<string | number, unknown>>(\n\t\ttoken: JwtTokenString\n\t): JwtToken<Claims> | null {\n\t\tconst convertedSegments = JwtToken.splitTokenString(token);\n\t\tif (!convertedSegments) return null;\n\n\t\tconst header = decodeJsonLikeBase64<JwtTokenHeader>(convertedSegments[0]);\n\t\tconst payload = decodeJsonLikeBase64<JwtTokenPayload & Claims>(convertedSegments[1]);\n\t\tconst signature = Base64.decode(convertedSegments[2]); // Not used, only for validation\n\t\tif (!header || !payload || !signature) return null;\n\n\t\treturn new JwtToken<Claims>(header, payload, signature);\n\t}\n\n\tpublic static stripScheme(jwtHeaderValue: string, scheme?: string): JwtTokenString {\n\t\treturn jwtHeaderValue.substring((scheme ?? '').length);\n\t}\n\n\tpublic static splitTokenString(\n\t\ttoken: JwtTokenString,\n\t\tseparator: string = JwtToken.JWT_TOKEN_SEPARATOR\n\t): [Base64String, Base64String, Base64String] | null {\n\t\tconst spl = token.split(separator);\n\t\tif (spl.length !== 3) {\n\t\t\treturn null;\n\t\t}\n\t\treturn spl as [Base64String, Base64String, Base64String];\n\t}\n\n\tpublic isExpired(): boolean {\n\t\treturn isUnixTimestampExpired(this.payload.exp);\n\t}\n}\n","import { InjectionToken } from '@angular/core';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport { TypedProvider } from '../model/typed-providers.interface';\n\nexport const JWT_CONFIGURATION_TOKEN = new InjectionToken<JwtConfiguration>(\n\t'AegisJwtConfiguration'\n);\n\nexport const DEFAULT_JWT_CONFIGURATION_TOKEN = new InjectionToken<Partial<JwtConfiguration>>(\n\t'DefaultAegisJwtConfiguration'\n);\n\nexport const JWT_REFRESH_CONFIGURATION_TOKEN = new InjectionToken<\n\tJwtRefreshConfiguration<unknown, unknown>\n>('AegisJwtRefreshConfiguration');\n\nexport const DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN = new InjectionToken<\n\tPartial<JwtRefreshConfiguration<unknown, unknown>>\n>('DefaultAegisJwtRefreshConfiguration');\n\n/**\n * To provide an {@link AuthTokenConfiguration |  AuthTokenConfiguration}\n */\nexport type JwtConfigurationProvider<> = TypedProvider<JwtConfiguration>;\n\n/**\n * To provide an {@link AuthTokenConfiguration |  AuthTokenConfiguration}\n */\nexport type JwtRefreshConfigurationProvider<RefreshRequest, RefreshResponse> = TypedProvider<\n\tJwtRefreshConfiguration<RefreshRequest, RefreshResponse>\n>;\n\n/**\n * This type describes a providerlike object that doesn't have a provide field\n * because that will be defaulted by the\n * {@link createRefreshableAuthTokenProvider | createRefreshableAuthTokenProvider }\n * function\n */\nexport type JwtModuleConfigurationProvider = Partial<\n\tOmit<TypedProvider<Partial<JwtConfiguration>>, 'provide' | 'multi'>\n>;\n\nexport type JwtModuleRefreshConfigurationProvider<RefreshRequest, RefreshResponse> = Partial<\n\tOmit<\n\t\tTypedProvider<Partial<JwtRefreshConfiguration<RefreshRequest, RefreshResponse>>>,\n\t\t'provide' | 'multi'\n\t>\n>;\n","import { HttpHandler } from '@angular/common/http';\nimport { Inject, Injectable, Optional } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map, switchMap } from 'rxjs/operators';\nimport { JwtCouldntRefreshError } from '../errors/jwt-error.class';\nimport { handleJwtError } from '../function/handle-jwt-error.function';\nimport { intoObservable } from '../function/into-observable.function';\nimport { isNotNullish } from '../function/is-not-nullish.predicate';\nimport { isUnixTimestampExpiredNowAndWhenItIs } from '../function/is-unix-timestamp-expired-now-and-when-it-is.function';\nimport { isString } from '../function/string.predicate';\nimport { tryJwtRefresh } from '../function/try-jwt-refresh.function';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport { JwtToken } from '../model/jwt-token.class';\nimport {\n\tDEFAULT_JWT_CONFIGURATION_TOKEN,\n\tDEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\tJWT_CONFIGURATION_TOKEN,\n\tJWT_REFRESH_CONFIGURATION_TOKEN,\n} from '../token/jwt-configuration.token';\n\n@Injectable({\n\tprovidedIn: 'root',\n})\nexport class JwtTokenService<\n\tClaims = Record<string | number, unknown>,\n\tRefreshClaims = Record<string | number, unknown>,\n\tRefreshRequest = Record<string | number, unknown>,\n\tRefreshResponse = Record<string | number, unknown>\n> {\n\tpublic constructor(\n\t\tprivate readonly httpHandler: HttpHandler,\n\t\t@Inject(JWT_CONFIGURATION_TOKEN)\n\t\tprivate readonly rawConfig: JwtConfiguration,\n\t\t@Inject(DEFAULT_JWT_CONFIGURATION_TOKEN)\n\t\tprivate readonly rawDefaultConfig: JwtConfiguration,\n\t\t@Inject(DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\t@Optional()\n\t\tprivate readonly rawDefaultRefreshConfig?: JwtRefreshConfiguration<\n\t\t\tRefreshRequest,\n\t\t\tRefreshResponse\n\t\t>,\n\t\t@Inject(JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\t@Optional()\n\t\tprivate readonly rawRefreshConfig?: JwtRefreshConfiguration<\n\t\t\tRefreshRequest,\n\t\t\tRefreshResponse\n\t\t>,\n\t\t@Optional() private readonly router?: Router\n\t) {}\n\tpublic readonly config: JwtConfiguration = {\n\t\t...this.rawDefaultConfig,\n\t\t...this.rawConfig,\n\t};\n\n\tpublic readonly refreshConfig?: JwtRefreshConfiguration<RefreshRequest, RefreshResponse> =\n\t\tthis.rawDefaultRefreshConfig && this.rawRefreshConfig\n\t\t\t? {\n\t\t\t\t\t...this.rawDefaultRefreshConfig,\n\t\t\t\t\t...this.rawRefreshConfig,\n\t\t\t  }\n\t\t\t: undefined;\n\n\t/**\n\t * Consider restricting getToken to observables only so things can be cached\n\t */\n\tpublic readonly rawAccessToken$ = intoObservable(this.config.getToken);\n\n\tpublic readonly rawRefreshToken$ = this.refreshConfig?.getRefreshToken\n\t\t? intoObservable(this.refreshConfig.getRefreshToken)\n\t\t: of(null);\n\n\tpublic readonly accessToken$ = this.rawAccessToken$.pipe(\n\t\tmap((token) => {\n\t\t\tif (isString(token)) {\n\t\t\t\tconst jwtToken = JwtToken.from<Claims>(token);\n\t\t\t\tif (!jwtToken) throw new Error('Non-valid token observed');\n\t\t\t\telse return jwtToken;\n\t\t\t} else return null;\n\t\t})\n\t);\n\n\tpublic readonly refreshToken$ = this.rawRefreshToken$.pipe(\n\t\tmap((refreshToken) => {\n\t\t\tif (isString(refreshToken)) {\n\t\t\t\tconst jwtToken = JwtToken.from<RefreshClaims>(refreshToken);\n\t\t\t\tif (!jwtToken) throw new Error('Non-valid token observed');\n\t\t\t\telse return jwtToken;\n\t\t\t} else return null;\n\t\t})\n\t);\n\n\tpublic readonly accessTokenHeader$ = this.accessToken$.pipe(\n\t\tmap((token) => token?.header ?? null)\n\t);\n\n\tpublic readonly accessTokenPayload$ = this.accessToken$.pipe(\n\t\tmap((token) => token?.payload ?? null)\n\t);\n\n\tpublic readonly refreshTokenHeader$ = this.refreshToken$.pipe(\n\t\tmap((token) => token?.header ?? null)\n\t);\n\n\tpublic readonly refreshTokenPayload$ = this.refreshToken$.pipe(\n\t\tmap((token) => token?.payload ?? null)\n\t);\n\n\tpublic readonly isAccessTokenExpired$ = this.accessToken$.pipe(\n\t\tswitchMap((token) =>\n\t\t\ttoken ? isUnixTimestampExpiredNowAndWhenItIs(token.payload.exp) : of(null)\n\t\t)\n\t);\n\n\tpublic readonly isRefreshTokenExpired$ = this.refreshToken$.pipe(\n\t\tswitchMap((token) =>\n\t\t\ttoken ? isUnixTimestampExpiredNowAndWhenItIs(token.payload.exp) : of(null)\n\t\t)\n\t);\n\n\tpublic readonly isAccessTokenValid$ = this.isAccessTokenExpired$.pipe(\n\t\tmap((isExpired) => isNotNullish(isExpired) && !isExpired)\n\t);\n\n\tpublic readonly isRefreshTokenValid$ = this.isRefreshTokenExpired$.pipe(\n\t\tmap((isExpired) => isNotNullish(isExpired) && !isExpired)\n\t);\n\n\t/**\n\t * Does a token refresh. Emits false if it failed, or true if succeeded.\n\t */\n\tpublic manualRefresh(): Observable<boolean> {\n\t\tif (this.refreshConfig) {\n\t\t\treturn tryJwtRefresh(\n\t\t\t\tthis.httpHandler,\n\t\t\t\t'Access token not valid on guard activation',\n\t\t\t\tthis.refreshConfig,\n\t\t\t\t(refreshError) =>\n\t\t\t\t\thandleJwtError<RefreshRequest, RefreshResponse>(\n\t\t\t\t\t\tJwtCouldntRefreshError.createErrorResponse(undefined, refreshError),\n\t\t\t\t\t\tthis.config,\n\t\t\t\t\t\tthis.refreshConfig,\n\t\t\t\t\t\tthis.router\n\t\t\t\t\t).pipe(catchError(() => of(false))),\n\t\t\t\t() => of(true)\n\t\t\t);\n\t\t} else {\n\t\t\treturn of(false);\n\t\t}\n\t}\n}\n","import { Injectable } from '@angular/core';\nimport {\n\tActivatedRouteSnapshot,\n\tCanActivate,\n\tCanActivateChild,\n\tCanLoad,\n\tRoute,\n\tRouterStateSnapshot,\n\tUrlSegment,\n\tUrlTree,\n} from '@angular/router';\nimport { Observable, of } from 'rxjs';\nimport { switchMap, take } from 'rxjs/operators';\nimport { DEFAULT_JWT_REFRESH_CONFIG_DEFAULT_AUTO_IN_GUARD } from '../model/auth-core-configuration.interface';\nimport { JwtTokenService } from '../service/jwt-token.service';\n\n/**\n * This interface is for your convinience to use with Route data to see what\n * you can configure on the LoginGuard\n */\nexport interface LoginGuardData {\n\t/**\n\t * Explicitly enable or disable auto refreshing on the route.\n\t */\n\tisRefreshAllowed: boolean;\n}\n\n@Injectable({\n\tprovidedIn: 'root',\n})\nexport class LoginGuard implements CanActivate, CanActivateChild, CanLoad {\n\tprivate isAccessTokenValidOnce$ = this.jwtTokenService.isAccessTokenValid$.pipe(take(1));\n\n\tpublic constructor(private readonly jwtTokenService: JwtTokenService) {}\n\n\tprivate isValid(isRefreshAllowed: boolean | undefined): Observable<boolean> {\n\t\tconst allowed =\n\t\t\tisRefreshAllowed ??\n\t\t\tthis.jwtTokenService.refreshConfig?.isAutoRefreshAllowedInLoginGuardByDefault ??\n\t\t\tDEFAULT_JWT_REFRESH_CONFIG_DEFAULT_AUTO_IN_GUARD;\n\t\treturn this.isAccessTokenValidOnce$.pipe(\n\t\t\tswitchMap((isValid) => {\n\t\t\t\tif (!isValid && allowed) {\n\t\t\t\t\treturn this.jwtTokenService.manualRefresh();\n\t\t\t\t} else {\n\t\t\t\t\treturn of(isValid);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\tpublic canActivate(\n\t\troute: ActivatedRouteSnapshot,\n\t\t_state: RouterStateSnapshot\n\t): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {\n\t\tconst data = route.data as LoginGuardData | undefined;\n\t\treturn this.isValid(data?.isRefreshAllowed);\n\t}\n\n\tpublic canActivateChild(\n\t\tchildRoute: ActivatedRouteSnapshot,\n\t\t_state: RouterStateSnapshot\n\t): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {\n\t\tconst data = childRoute.data as LoginGuardData | undefined;\n\t\treturn this.isValid(data?.isRefreshAllowed);\n\t}\n\n\tpublic canLoad(\n\t\troute: Route,\n\t\t_segments: UrlSegment[]\n\t): Observable<boolean> | Promise<boolean> | boolean {\n\t\tconst data = route.data as LoginGuardData | undefined;\n\t\treturn this.isValid(data?.isRefreshAllowed);\n\t}\n}\n","import {\n\tHttpErrorResponse,\n\tHttpEvent,\n\tHttpHandler,\n\tHttpInterceptor,\n\tHttpRequest,\n} from '@angular/common/http';\nimport { Inject, Injectable, Optional } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { handleJwtError } from '../function/handle-jwt-error.function';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport {\n\tDEFAULT_JWT_CONFIGURATION_TOKEN,\n\tDEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\tJWT_CONFIGURATION_TOKEN,\n\tJWT_REFRESH_CONFIGURATION_TOKEN,\n} from '../token/jwt-configuration.token';\n\n/**\n * If configured, handles authentication errors with custom callbacks\n * or redirects\n */\n@Injectable()\nexport class JwtErrorHandlingInterceptor implements HttpInterceptor {\n\tprivate readonly jwtConfiguration: JwtConfiguration;\n\tprivate readonly jwtRefreshConfiguration?: JwtRefreshConfiguration<unknown, unknown>;\n\tpublic constructor(\n\t\t@Inject(JWT_CONFIGURATION_TOKEN)\n\t\tjwtConfig: JwtConfiguration,\n\t\t@Inject(DEFAULT_JWT_CONFIGURATION_TOKEN)\n\t\tdefaultJwtConfig: JwtConfiguration,\n\t\t@Optional()\n\t\t@Inject(JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\trefreshConfig?: JwtRefreshConfiguration<unknown, unknown>,\n\t\t@Optional()\n\t\t@Inject(DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\tdefaultJwtRefreshConfig?: JwtRefreshConfiguration<unknown, unknown>,\n\t\t@Optional() private readonly router?: Router\n\t) {\n\t\tthis.jwtConfiguration = {\n\t\t\t...defaultJwtConfig,\n\t\t\t...jwtConfig,\n\t\t};\n\n\t\tthis.jwtRefreshConfiguration =\n\t\t\tdefaultJwtRefreshConfig && refreshConfig\n\t\t\t\t? {\n\t\t\t\t\t\t...defaultJwtRefreshConfig,\n\t\t\t\t\t\t...refreshConfig,\n\t\t\t\t  }\n\t\t\t\t: undefined;\n\t}\n\tpublic intercept(\n\t\trequest: HttpRequest<unknown>,\n\t\tnext: HttpHandler\n\t): Observable<HttpEvent<unknown>> {\n\t\treturn next\n\t\t\t.handle(request)\n\t\t\t.pipe(\n\t\t\t\tcatchError((errorResponse: HttpErrorResponse) =>\n\t\t\t\t\thandleJwtError(\n\t\t\t\t\t\terrorResponse,\n\t\t\t\t\t\tthis.jwtConfiguration,\n\t\t\t\t\t\tthis.jwtRefreshConfiguration,\n\t\t\t\t\t\tthis.router\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t}\n}\n","import { isString } from './string.predicate';\n\nexport const matchRule = (rule: string | RegExp, against?: string | null): boolean => {\n\tif (isString(rule)) return rule === against;\n\telse if (against) return rule.test(against);\n\telse return false;\n};\n\n/**\n *\n * @param inverse easy negating when composing\n */\nexport const matchAgainst = (against?: string | null, inverse = false) => (\n\trule: string | RegExp\n): boolean => (inverse ? !matchRule(rule, against) : matchRule(rule, against));\n","import { UrlFilter } from '../model/header-configuration.interface';\nimport { matchAgainst } from './match-against.function';\nimport { SeparatedUrl } from './separate-url.function';\n\n/**\n * Matches the filter against a separated url. Non-existend rulesets\n * automatically pass. **Empty whitelist rulesets never pass.** Empty blacklist\n * rulesets always pass.\n */\nexport function checkAgainstUrlFilter(\n\turlFilter: UrlFilter,\n\t{ domain, path, protocol }: SeparatedUrl\n): boolean {\n\tconst protocolMatcher = matchAgainst(protocol);\n\tconst domainMatcher = matchAgainst(domain);\n\tconst pathMatcher = matchAgainst(path);\n\n\tconst protocolWhitelistRulesPass = urlFilter.protocolWhitelist?.some(protocolMatcher) ?? true;\n\n\tconst protocolBlacklistRulesPass = !urlFilter.protocolBlacklist?.some(protocolMatcher);\n\n\tconst domainWhitelistRulesPass = urlFilter.domainWhitelist?.some(domainMatcher) ?? true;\n\n\tconst domainBlacklistRulesPass = !urlFilter.domainBlacklist?.some(domainMatcher);\n\n\tconst pathWhitelistRulesPass = urlFilter.pathWhitelist?.some(pathMatcher) ?? true;\n\n\tconst pathBlacklistRulesPass = !urlFilter.pathBlacklist?.some(pathMatcher);\n\n\treturn (\n\t\tprotocolWhitelistRulesPass &&\n\t\tprotocolBlacklistRulesPass &&\n\t\tdomainWhitelistRulesPass &&\n\t\tdomainBlacklistRulesPass &&\n\t\tpathWhitelistRulesPass &&\n\t\tpathBlacklistRulesPass\n\t);\n}\n","export type UrlProtocol = string;\nexport type UrlDomain = string;\nexport type UrlPath = string;\n\n/**\n * An url separated into optional parts, the separators are not included.\n * Separator between protocol and domain is `://`, and between domain\n * and path is `/`.\n */\nexport interface SeparatedUrl {\n\t/**\n\t * @example `http`\n\t */\n\tprotocol?: UrlProtocol;\n\n\t/**\n\t * @example `localhost`\n\t */\n\tdomain?: UrlDomain;\n\n\t/**\n\t * @example `foo/bar`\n\t */\n\tpath?: UrlPath;\n}\n\n/**\n * Returns the url split into parts, without the separators.\n * Separator between protocol and domain is `://`, and between domain\n * and path is `/`.\n */\nexport function separateUrl(url?: string): SeparatedUrl {\n\tconst urlMatch = url?.match(/^((.*):\\/\\/)?([^/].*?)?(\\/(.*))?$/);\n\treturn {\n\t\tprotocol: urlMatch?.[2] as UrlProtocol,\n\t\tdomain: urlMatch?.[3] as UrlDomain,\n\t\tpath: urlMatch?.[5] as UrlPath,\n\t};\n}\n","import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\nimport { Inject, Injectable, Optional } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\nimport { switchMap, take } from 'rxjs/operators';\nimport { JwtError } from '../errors/jwt-error.class';\nimport { checkAgainstUrlFilter } from '../function/check-against-url-filter.function';\nimport { intoObservable } from '../function/into-observable.function';\nimport { separateUrl } from '../function/separate-url.function';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport { JwtToken } from '../model/jwt-token.class';\nimport {\n\tDEFAULT_JWT_CONFIGURATION_TOKEN,\n\tDEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\tJWT_CONFIGURATION_TOKEN,\n\tJWT_REFRESH_CONFIGURATION_TOKEN,\n} from '../token/jwt-configuration.token';\n\n@Injectable()\nexport class JwtInjectorInterceptor implements HttpInterceptor {\n\tprivate readonly jwtConfiguration!: JwtConfiguration;\n\tprivate readonly jwtRefreshConfiguration?: JwtRefreshConfiguration<unknown, unknown>;\n\n\tpublic constructor(\n\t\t@Inject(JWT_CONFIGURATION_TOKEN)\n\t\tjwtConfig: JwtConfiguration,\n\t\t@Inject(DEFAULT_JWT_CONFIGURATION_TOKEN)\n\t\tdefaultJwtConfig: JwtConfiguration,\n\t\t@Optional()\n\t\t@Inject(JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\trefreshConfig?: JwtRefreshConfiguration<unknown, unknown>,\n\t\t@Optional()\n\t\t@Inject(DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\tdefaultJwtRefreshConfig?: JwtRefreshConfiguration<unknown, unknown>\n\t) {\n\t\tthis.jwtConfiguration = {\n\t\t\t...defaultJwtConfig,\n\t\t\t...jwtConfig,\n\t\t};\n\n\t\tthis.jwtRefreshConfiguration = refreshConfig &&\n\t\t\tdefaultJwtRefreshConfig && {\n\t\t\t\t...defaultJwtRefreshConfig,\n\t\t\t\t...refreshConfig,\n\t\t\t};\n\t}\n\n\tpublic intercept(\n\t\trequest: HttpRequest<unknown>,\n\t\tnext: HttpHandler\n\t): Observable<HttpEvent<unknown>> {\n\t\tconst separatedUrl = separateUrl(request.url);\n\t\treturn intoObservable(this.jwtConfiguration.getToken).pipe(\n\t\t\ttake(1),\n\t\t\tswitchMap((rawToken) => {\n\t\t\t\tif (checkAgainstUrlFilter(this.jwtConfiguration, separatedUrl)) {\n\t\t\t\t\tconst token = rawToken && JwtToken.from(rawToken);\n\t\t\t\t\tconst isAccessTokenExpiredOrInvalid = !token || token.isExpired();\n\t\t\t\t\t// If there is a token to inject\n\t\t\t\t\tif (\n\t\t\t\t\t\trawToken &&\n\t\t\t\t\t\t(!isAccessTokenExpiredOrInvalid || this.jwtRefreshConfiguration)\n\t\t\t\t\t) {\n\t\t\t\t\t\tlet cloned = request.clone({\n\t\t\t\t\t\t\theaders: request.headers.set(\n\t\t\t\t\t\t\t\tthis.jwtConfiguration.header,\n\t\t\t\t\t\t\t\tthis.jwtConfiguration.scheme\n\t\t\t\t\t\t\t\t\t? this.jwtConfiguration.scheme + rawToken\n\t\t\t\t\t\t\t\t\t: rawToken\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (this.jwtConfiguration.handleWithCredentials) {\n\t\t\t\t\t\t\tcloned = cloned.clone({\n\t\t\t\t\t\t\t\twithCredentials: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn next.handle(cloned);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn throwError(\n\t\t\t\t\t\t\tJwtError.createErrorResponse(\n\t\t\t\t\t\t\t\trequest,\n\t\t\t\t\t\t\t\t'Token is expired or invalid, and refresh is not configured.'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else return next.handle(request);\n\t\t\t})\n\t\t);\n\t}\n}\n","import {\n\tHttpErrorResponse,\n\tHttpEvent,\n\tHttpHandler,\n\tHttpInterceptor,\n\tHttpRequest,\n} from '@angular/common/http';\nimport { Inject, Injectable } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, switchMap, take } from 'rxjs/operators';\nimport { JwtCannotRefreshError, JwtCouldntRefreshError } from '../errors/jwt-error.class';\nimport { checkAgainstUrlFilter } from '../function/check-against-url-filter.function';\nimport { intoObservable } from '../function/into-observable.function';\nimport { matchAgainst } from '../function/match-against.function';\nimport { tryJwtRefresh } from '../function/try-jwt-refresh.function';\nimport { separateUrl } from '../function/separate-url.function';\nimport {\n\tJwtConfiguration,\n\tJwtRefreshConfiguration,\n} from '../model/auth-core-configuration.interface';\nimport { JwtToken } from '../model/jwt-token.class';\nimport {\n\tDEFAULT_JWT_CONFIGURATION_TOKEN,\n\tDEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\tJWT_CONFIGURATION_TOKEN,\n\tJWT_REFRESH_CONFIGURATION_TOKEN,\n} from '../token/jwt-configuration.token';\n\n@Injectable()\nexport class JwtRefreshInterceptor implements HttpInterceptor {\n\tprivate readonly jwtConfiguration!: JwtConfiguration;\n\tprivate readonly jwtRefreshConfiguration!: JwtRefreshConfiguration<unknown, unknown>;\n\tprivate readonly rawRefreshToken$: Observable<string | null | undefined>;\n\tprivate readonly isRawRefreshTokenGetterAvailable: boolean;\n\n\tpublic constructor(\n\t\t@Inject(JWT_CONFIGURATION_TOKEN)\n\t\tjwtConfig: JwtConfiguration,\n\t\t@Inject(DEFAULT_JWT_CONFIGURATION_TOKEN)\n\t\tdefaultJwtConfig: JwtConfiguration,\n\t\t@Inject(JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\trefreshConfig: JwtRefreshConfiguration<unknown, unknown>,\n\t\t@Inject(DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN)\n\t\tdefaultJwtRefreshConfig: JwtRefreshConfiguration<unknown, unknown>\n\t) {\n\t\tthis.jwtConfiguration = {\n\t\t\t...defaultJwtConfig,\n\t\t\t...jwtConfig,\n\t\t};\n\n\t\tthis.jwtRefreshConfiguration = {\n\t\t\t...defaultJwtRefreshConfig,\n\t\t\t...refreshConfig,\n\t\t};\n\n\t\tthis.rawRefreshToken$ = intoObservable(\n\t\t\tthis.jwtRefreshConfiguration.getRefreshToken ?? (() => null)\n\t\t);\n\n\t\tthis.isRawRefreshTokenGetterAvailable = !!this.jwtRefreshConfiguration.getRefreshToken;\n\t}\n\n\tpublic intercept(\n\t\trequest: HttpRequest<unknown>,\n\t\tnext: HttpHandler\n\t): Observable<HttpEvent<unknown>> {\n\t\tconst separatedUrl = separateUrl(request.url);\n\t\tconst jwtHeaderValue = request.headers.get(this.jwtConfiguration.header);\n\n\t\t// Only do something if the request is headed towards a protected endpoint.\n\t\t// The forRoot method of the module ensures that this interceptor is injected\n\t\t// after the token injector interceptor. So by the time this executes, the token should\n\t\t// be here.\n\t\t// And if the url is not the refresh url itself, and any of the other explicitly\n\t\t// filtered urls where refresh is prohibited by config.\n\t\tif (\n\t\t\tjwtHeaderValue &&\n\t\t\t!matchAgainst(request.url)(this.jwtRefreshConfiguration.refreshUrl) &&\n\t\t\tcheckAgainstUrlFilter(this.jwtRefreshConfiguration, separatedUrl)\n\t\t) {\n\t\t\treturn this.rawRefreshToken$.pipe(\n\t\t\t\ttake(1),\n\t\t\t\tswitchMap((rawRefreshToken) => {\n\t\t\t\t\tconst rawToken = JwtToken.stripScheme(\n\t\t\t\t\t\tjwtHeaderValue,\n\t\t\t\t\t\tthis.jwtConfiguration.scheme\n\t\t\t\t\t);\n\t\t\t\t\tconst token = JwtToken.from(rawToken);\n\t\t\t\t\tconst refreshToken = rawRefreshToken ? JwtToken.from(rawRefreshToken) : null;\n\t\t\t\t\tconst isAccessTokenExpiredOrInvalid = !token || token.isExpired();\n\t\t\t\t\tconst isRefreshTokenExpiredOrInvalid =\n\t\t\t\t\t\t!refreshToken || refreshToken.isExpired();\n\t\t\t\t\t// If we know beforehand that nothing can be done, panic.\n\t\t\t\t\tif (\n\t\t\t\t\t\tisAccessTokenExpiredOrInvalid &&\n\t\t\t\t\t\tthis.isRawRefreshTokenGetterAvailable &&\n\t\t\t\t\t\tisRefreshTokenExpiredOrInvalid\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn throwError(\n\t\t\t\t\t\t\tJwtCannotRefreshError.createErrorResponse(\n\t\t\t\t\t\t\t\trequest,\n\t\t\t\t\t\t\t\t'Both access and refresh tokens are expired'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the conversion would fail, that would handle the same as an expired token\n\t\t\t\t\treturn (isAccessTokenExpiredOrInvalid\n\t\t\t\t\t\t? // If the token is used and is expired, don't even try the request.\n\t\t\t\t\t\t  throwError('Expired token, refresh first')\n\t\t\t\t\t\t: // If it seems okay, try the request\n\t\t\t\t\t\t  next.handle(request)\n\t\t\t\t\t).pipe(\n\t\t\t\t\t\tcatchError((error: HttpErrorResponse | string) => {\n\t\t\t\t\t\t\t// If the request failed, or we failed at the precheck\n\t\t\t\t\t\t\t// Acquire a new token, but only if the error is allowing it\n\n\t\t\t\t\t\t\treturn tryJwtRefresh(\n\t\t\t\t\t\t\t\tnext,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\tthis.jwtRefreshConfiguration,\n\t\t\t\t\t\t\t\t(refreshError) =>\n\t\t\t\t\t\t\t\t\tthrowError(\n\t\t\t\t\t\t\t\t\t\tJwtCouldntRefreshError.createErrorResponse(\n\t\t\t\t\t\t\t\t\t\t\trequest,\n\t\t\t\t\t\t\t\t\t\t\trefreshError\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t(refreshResponse) => {\n\t\t\t\t\t\t\t\t\tconst requestWithUpdatedTokens = request.clone({\n\t\t\t\t\t\t\t\t\t\theaders: request.headers.set(\n\t\t\t\t\t\t\t\t\t\t\tthis.jwtConfiguration.header,\n\t\t\t\t\t\t\t\t\t\t\tthis.jwtConfiguration.scheme +\n\t\t\t\t\t\t\t\t\t\t\t\trefreshResponse.accessToken\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn next.handle(requestWithUpdatedTokens);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t);\n\t\t} else return next.handle(request);\n\t}\n}\n","import { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { JwtErrorHandlingInterceptor } from './interceptor/jwt-error-handling.interceptor';\nimport { JwtInjectorInterceptor } from './interceptor/jwt-injector.interceptor';\nimport { JwtRefreshInterceptor } from './interceptor/jwt-refresh.interceptor';\nimport {\n\tDEFAULT_JWT_CONFIG,\n\tDEFAULT_JWT_REFRESH_CONFIG,\n} from './model/auth-core-configuration.interface';\nimport {\n\tDEFAULT_JWT_CONFIGURATION_TOKEN,\n\tDEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\tJwtConfigurationProvider,\n\tJwtModuleConfigurationProvider,\n\tJwtModuleRefreshConfigurationProvider,\n\tJwtRefreshConfigurationProvider,\n\tJWT_CONFIGURATION_TOKEN,\n\tJWT_REFRESH_CONFIGURATION_TOKEN,\n} from './token/jwt-configuration.token';\n\n/**\n * Helps you define a JwtConfigurationProvider\n *\n * @internal\n */\nexport function createJwtConfigurationProvider(\n\ttokenConfigurationProvider: JwtModuleConfigurationProvider\n): JwtConfigurationProvider {\n\treturn {\n\t\tprovide: JWT_CONFIGURATION_TOKEN,\n\t\tmulti: false,\n\t\t...tokenConfigurationProvider,\n\t} as JwtConfigurationProvider;\n}\n\n/**\n * Helps you define a JwtConfigurationProvider\n *\n * @internal\n */\nexport function createJwtRefreshConfigurationProvider<RefreshRequest, RefreshResponse>(\n\ttokenRefreshConfigurationProvider: JwtModuleRefreshConfigurationProvider<\n\t\tRefreshRequest,\n\t\tRefreshResponse\n\t>\n): JwtRefreshConfigurationProvider<RefreshRequest, RefreshResponse> {\n\treturn {\n\t\tprovide: JWT_REFRESH_CONFIGURATION_TOKEN,\n\t\tmulti: false,\n\t\t...tokenRefreshConfigurationProvider,\n\t} as JwtRefreshConfigurationProvider<RefreshRequest, RefreshResponse>;\n}\n\n/**\n * This module needs to be configured to use. See the\n * {@link JwtModule#forRoot | forRoot} method for more information.\n *\n * tokens. So that other, plug in configration modules can provide them.\n * Like Ngrx and Local. They then transform their configs into this common one.\n */\n@NgModule({\n\timports: [CommonModule],\n})\nexport class JwtModule {\n\t/**\n\t * To define the interceptors and the token with the provided config.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * (a)NgModule({\n\t *\t\timports: [\n\t *\t\t\tJwtModule.forRoot<Foo>({\n\t *\t\t\t\t\tuseFactory: (foo) => foo.getConf(),\n\t *\t\t\t\t\tdeps: [Foo] // if something has to be injected\n\t *\t\t\t})\n\t *\t\t]\n\t *\t})\n\t *\texport class CoreModule {}\n\t * ```\n\t * @param tokenProvider create with `createAuthTokenProvider` or\n\t * \t`createRefreshableAuthTokenProvider`\n\t */\n\tpublic static forRoot(\n\t\tjwtModuleConfigurationProvider: JwtModuleConfigurationProvider\n\t): ModuleWithProviders<JwtModule>;\n\tpublic static forRoot<RefreshRequest, RefreshResponse>(\n\t\tjwtModuleConfigurationProvider: JwtModuleConfigurationProvider,\n\t\tjwtRefreshConfigurationProvider: JwtModuleRefreshConfigurationProvider<\n\t\t\tRefreshRequest,\n\t\t\tRefreshResponse\n\t\t>\n\t): ModuleWithProviders<JwtModule>;\n\tpublic static forRoot<RefreshRequest, RefreshResponse>(\n\t\tjwtModuleConfigurationProvider: JwtModuleConfigurationProvider,\n\t\tjwtRefreshConfigurationProvider?: JwtModuleRefreshConfigurationProvider<\n\t\t\tRefreshRequest,\n\t\t\tRefreshResponse\n\t\t>\n\t): ModuleWithProviders<JwtModule> {\n\t\treturn {\n\t\t\tngModule: JwtModule,\n\t\t\tproviders: [\n\t\t\t\t{\n\t\t\t\t\tprovide: HTTP_INTERCEPTORS,\n\t\t\t\t\tuseClass: JwtErrorHandlingInterceptor,\n\t\t\t\t\tmulti: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprovide: HTTP_INTERCEPTORS,\n\t\t\t\t\tuseClass: JwtInjectorInterceptor,\n\t\t\t\t\tmulti: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprovide: DEFAULT_JWT_CONFIGURATION_TOKEN,\n\t\t\t\t\tuseValue: DEFAULT_JWT_CONFIG,\n\t\t\t\t},\n\t\t\t\tcreateJwtConfigurationProvider(jwtModuleConfigurationProvider),\n\t\t\t\t...(jwtRefreshConfigurationProvider\n\t\t\t\t\t? [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprovide: HTTP_INTERCEPTORS,\n\t\t\t\t\t\t\t\tuseClass: JwtRefreshInterceptor,\n\t\t\t\t\t\t\t\tmulti: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprovide: DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN,\n\t\t\t\t\t\t\t\tuseValue: DEFAULT_JWT_REFRESH_CONFIG,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreateJwtRefreshConfigurationProvider<RefreshRequest, RefreshResponse>(\n\t\t\t\t\t\t\t\tjwtRefreshConfigurationProvider\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: []),\n\t\t\t],\n\t\t};\n\t}\n}\n","export enum HttpMethod {\n\tGET = 'GET',\n\tHEAD = 'HEAD',\n\tPOST = 'POST',\n\tPUT = 'PUT',\n\tDELETE = 'DELETE',\n\tCONNECT = 'CONNECT',\n\tOPTIONS = 'OPTIONS',\n\tTRACE = 'TRACE',\n\tPATCH = 'PATCH',\n}\n\nexport type HttpMethodType =\n\t| 'GET'\n\t| 'HEAD'\n\t| 'POST'\n\t| 'PUT'\n\t| 'DELETE'\n\t| 'CONNECT'\n\t| 'OPTIONS'\n\t| 'TRACE'\n\t| 'PATCH';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {JwtErrorHandlingInterceptor as ɵe} from './lib/interceptor/jwt-error-handling.interceptor';\nexport {JwtInjectorInterceptor as ɵf} from './lib/interceptor/jwt-injector.interceptor';\nexport {JwtRefreshInterceptor as ɵg} from './lib/interceptor/jwt-refresh.interceptor';\nexport {DEFAULT_JWT_CONFIGURATION_TOKEN as ɵb,DEFAULT_JWT_REFRESH_CONFIGURATION_TOKEN as ɵd,JWT_CONFIGURATION_TOKEN as ɵa,JWT_REFRESH_CONFIGURATION_TOKEN as ɵc} from './lib/token/jwt-configuration.token';"],"names":["BehaviorSubject","HttpErrorResponse","throwError","isObservable","of","switchMap","from","merge","timer","mapTo","HttpEventType","HttpRequest","filter","map","tap","mergeMap","catchError","take","Base64","InjectionToken","Injectable","HttpHandler","Inject","Optional","Router","HTTP_INTERCEPTORS","NgModule","CommonModule","HttpMethod"],"mappings":";;;;;;IAAA;;;;;aAKgB,sBAAsB,CAAC,aAAyB;QAAzB,8BAAA,EAAA,iBAAiB,QAAQ;QAC/D,OAAO,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;IAChE;;QCLa,qBAAqB,GAAiC;QAClE,QAAQ,EAAE,IAAIA,oBAAe,CAA4B,IAAI,CAAC;;;QCQlD,kBAAkB,GAAG,gBAAgB;QACrC,kBAAkB,GAAG,UAAU;QAE/B,kBAAkB,mCAC3B,qBAAqB,KACxB,MAAM,EAAE,kBAAkB,EAC1B,MAAM,EAAE,kBAAkB,EAC1B,qBAAqB,EAAE,IAAI,IAC1B;QAEW,gDAAgD,GAAG,KAAK;QAExD,0BAA0B,GAAuD;QAC7F,MAAM,EAAE,MAAM;QACd,kBAAkB,EAAE,CAAC,GAAG,CAAC;QACzB,yCAAyC,EAAE,gDAAgD;;;IC1B5F;;;;;;;;;;;;;;IAcA;IAEA,IAAI,aAAa,GAAG,UAAS,CAAC,EAAE,CAAC;QAC7B,aAAa,GAAG,MAAM,CAAC,cAAc;aAChC,EAAE,SAAS,EAAE,EAAE,EAAE,YAAY,KAAK,IAAI,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC;YAC5E,UAAU,CAAC,EAAE,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC;gBAAE,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;oBAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACtG,OAAO,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC/B,CAAC,CAAC;aAEc,SAAS,CAAC,CAAC,EAAE,CAAC;QAC1B,aAAa,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACpB,SAAS,EAAE,KAAK,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,EAAE;QACvC,CAAC,CAAC,SAAS,GAAG,CAAC,KAAK,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;IACzF,CAAC;IAEM,IAAI,QAAQ,GAAG;QAClB,QAAQ,GAAG,MAAM,CAAC,MAAM,IAAI,SAAS,QAAQ,CAAC,CAAC;YAC3C,KAAK,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;gBACjD,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;gBACjB,KAAK,IAAI,CAAC,IAAI,CAAC;oBAAE,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;wBAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;aAChF;YACD,OAAO,CAAC,CAAC;SACZ,CAAA;QACD,OAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;IAC3C,CAAC,CAAA;aAEe,MAAM,CAAC,CAAC,EAAE,CAAC;QACvB,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,KAAK,IAAI,CAAC,IAAI,CAAC;YAAE,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC;gBAC/E,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,CAAC,IAAI,IAAI,IAAI,OAAO,MAAM,CAAC,qBAAqB,KAAK,UAAU;YAC/D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,qBAAqB,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACpE,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,SAAS,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC1E,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aACzB;QACL,OAAO,CAAC,CAAC;IACb,CAAC;aAEe,UAAU,CAAC,UAAU,EAAE,MAAM,EAAE,GAAG,EAAE,IAAI;QACpD,IAAI,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,MAAM,GAAG,IAAI,KAAK,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC,wBAAwB,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,IAAI,EAAE,CAAC,CAAC;QAC7H,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,UAAU;YAAE,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;;YAC1H,KAAK,IAAI,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE;gBAAE,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC;oBAAE,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;QAClJ,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;IAClE,CAAC;aAEe,OAAO,CAAC,UAAU,EAAE,SAAS;QACzC,OAAO,UAAU,MAAM,EAAE,GAAG,IAAI,SAAS,CAAC,MAAM,EAAE,GAAG,EAAE,UAAU,CAAC,CAAC,EAAE,CAAA;IACzE,CAAC;aAEe,UAAU,CAAC,WAAW,EAAE,aAAa;QACjD,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,UAAU;YAAE,OAAO,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;IACnI,CAAC;aAEe,SAAS,CAAC,OAAO,EAAE,UAAU,EAAE,CAAC,EAAE,SAAS;QACvD,SAAS,KAAK,CAAC,KAAK,IAAI,OAAO,KAAK,YAAY,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,UAAU,OAAO,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;QAC5G,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,EAAE,UAAU,OAAO,EAAE,MAAM;YACrD,SAAS,SAAS,CAAC,KAAK,IAAI,IAAI;gBAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;aAAE;YAAC,OAAO,CAAC,EAAE;gBAAE,MAAM,CAAC,CAAC,CAAC,CAAC;aAAE,EAAE;YAC3F,SAAS,QAAQ,CAAC,KAAK,IAAI,IAAI;gBAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;aAAE;YAAC,OAAO,CAAC,EAAE;gBAAE,MAAM,CAAC,CAAC,CAAC,CAAC;aAAE,EAAE;YAC9F,SAAS,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,EAAE;YAC9G,IAAI,CAAC,CAAC,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;SACzE,CAAC,CAAC;IACP,CAAC;aAEe,WAAW,CAAC,OAAO,EAAE,IAAI;QACrC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,cAAa,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QACjH,OAAO,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,OAAO,MAAM,KAAK,UAAU,KAAK,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,cAAa,OAAO,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QACzJ,SAAS,IAAI,CAAC,CAAC,IAAI,OAAO,UAAU,CAAC,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;QAClE,SAAS,IAAI,CAAC,EAAE;YACZ,IAAI,CAAC;gBAAE,MAAM,IAAI,SAAS,CAAC,iCAAiC,CAAC,CAAC;YAC9D,OAAO,CAAC;gBAAE,IAAI;oBACV,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI;wBAAE,OAAO,CAAC,CAAC;oBAC7J,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;wBAAE,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;oBACxC,QAAQ,EAAE,CAAC,CAAC,CAAC;wBACT,KAAK,CAAC,CAAC;wBAAC,KAAK,CAAC;4BAAE,CAAC,GAAG,EAAE,CAAC;4BAAC,MAAM;wBAC9B,KAAK,CAAC;4BAAE,CAAC,CAAC,KAAK,EAAE,CAAC;4BAAC,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;wBACxD,KAAK,CAAC;4BAAE,CAAC,CAAC,KAAK,EAAE,CAAC;4BAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;4BAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;4BAAC,SAAS;wBACjD,KAAK,CAAC;4BAAE,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;4BAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;4BAAC,SAAS;wBACjD;4BACI,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;gCAAE,CAAC,GAAG,CAAC,CAAC;gCAAC,SAAS;6BAAE;4BAC5G,IAAI,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;gCAAE,CAAC,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;gCAAC,MAAM;6BAAE;4BACtF,IAAI,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;gCAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gCAAC,CAAC,GAAG,EAAE,CAAC;gCAAC,MAAM;6BAAE;4BACrE,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;gCAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gCAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gCAAC,MAAM;6BAAE;4BACnE,IAAI,CAAC,CAAC,CAAC,CAAC;gCAAE,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;4BACtB,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;4BAAC,SAAS;qBAC9B;oBACD,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;iBAC9B;gBAAC,OAAO,CAAC,EAAE;oBAAE,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAAC,CAAC,GAAG,CAAC,CAAC;iBAAE;wBAAS;oBAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;iBAAE;YAC1D,IAAI,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC;gBAAE,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;YAAC,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;SACpF;IACL,CAAC;IAEM,IAAI,eAAe,GAAG,MAAM,CAAC,MAAM,IAAI,UAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;QAC9D,IAAI,EAAE,KAAK,SAAS;YAAE,EAAE,GAAG,CAAC,CAAC;QAC7B,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,GAAG,EAAE,cAAa,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACzF,CAAC,KAAK,UAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;QACtB,IAAI,EAAE,KAAK,SAAS;YAAE,EAAE,GAAG,CAAC,CAAC;QAC7B,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACjB,CAAC,CAAC,CAAC;aAEa,YAAY,CAAC,CAAC,EAAE,CAAC;QAC7B,KAAK,IAAI,CAAC,IAAI,CAAC;YAAE,IAAI,CAAC,KAAK,SAAS,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;gBAAE,eAAe,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IAClH,CAAC;aAEe,QAAQ,CAAC,CAAC;QACtB,IAAI,CAAC,GAAG,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;QAC9E,IAAI,CAAC;YAAE,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACxB,IAAI,CAAC,IAAI,OAAO,CAAC,CAAC,MAAM,KAAK,QAAQ;YAAE,OAAO;gBAC1C,IAAI,EAAE;oBACF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM;wBAAE,CAAC,GAAG,KAAK,CAAC,CAAC;oBACnC,OAAO,EAAE,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC;iBAC3C;aACJ,CAAC;QACF,MAAM,IAAI,SAAS,CAAC,CAAC,GAAG,yBAAyB,GAAG,iCAAiC,CAAC,CAAC;IAC3F,CAAC;aAEe,MAAM,CAAC,CAAC,EAAE,CAAC;QACvB,IAAI,CAAC,GAAG,OAAO,MAAM,KAAK,UAAU,IAAI,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC3D,IAAI,CAAC,CAAC;YAAE,OAAO,CAAC,CAAC;QACjB,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;QACjC,IAAI;YACA,OAAO,CAAC,CAAC,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,IAAI;gBAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;SAC9E;QACD,OAAO,KAAK,EAAE;YAAE,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;SAAE;gBAC/B;YACJ,IAAI;gBACA,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;oBAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACpD;oBACO;gBAAE,IAAI,CAAC;oBAAE,MAAM,CAAC,CAAC,KAAK,CAAC;aAAE;SACpC;QACD,OAAO,EAAE,CAAC;IACd,CAAC;aAEe,QAAQ;QACpB,KAAK,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE;YAC9C,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACzC,OAAO,EAAE,CAAC;IACd,CAAC;aAEe,cAAc;QAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE;YAAE,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;QACpF,KAAK,IAAI,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE;YAC5C,KAAK,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE;gBAC7D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACpB,OAAO,CAAC,CAAC;IACb,CAAC;IAAA,CAAC;aAEc,OAAO,CAAC,CAAC;QACrB,OAAO,IAAI,YAAY,OAAO,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,IAAI,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC;IACzE,CAAC;aAEe,gBAAgB,CAAC,OAAO,EAAE,UAAU,EAAE,SAAS;QAC3D,IAAI,CAAC,MAAM,CAAC,aAAa;YAAE,MAAM,IAAI,SAAS,CAAC,sCAAsC,CAAC,CAAC;QACvF,IAAI,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;QAC9D,OAAO,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;QACtH,SAAS,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;YAAE,CAAC,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,IAAI,OAAO,IAAI,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE;QAC1I,SAAS,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,IAAI;YAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SAAE;QAAC,OAAO,CAAC,EAAE;YAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SAAE,EAAE;QAClF,SAAS,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,YAAY,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE;QACxH,SAAS,OAAO,CAAC,KAAK,IAAI,MAAM,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,EAAE;QAClD,SAAS,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,EAAE;QAClD,SAAS,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,MAAM;YAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IACtF,CAAC;aAEe,gBAAgB,CAAC,CAAC;QAC9B,IAAI,CAAC,EAAE,CAAC,CAAC;QACT,OAAO,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,IAAI,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;QAC5I,SAAS,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,IAAI,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,KAAK,QAAQ,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE;IACnJ,CAAC;aAEe,aAAa,CAAC,CAAC;QAC3B,IAAI,CAAC,MAAM,CAAC,aAAa;YAAE,MAAM,IAAI,SAAS,CAAC,sCAAsC,CAAC,CAAC;QACvF,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACnC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,OAAO,QAAQ,KAAK,UAAU,GAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,cAAc,OAAO,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QACjN,SAAS,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC,IAAI,OAAO,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE;QAChK,SAAS,MAAM,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAS,CAAC,IAAI,OAAO,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,EAAE;IAChI,CAAC;aAEe,oBAAoB,CAAC,MAAM,EAAE,GAAG;QAC5C,IAAI,MAAM,CAAC,cAAc,EAAE;YAAE,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC;SAAE;aAAM;YAAE,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC;SAAE;QAC/G,OAAO,MAAM,CAAC;IAClB,CAAC;IAAA,CAAC;IAEF,IAAI,kBAAkB,GAAG,MAAM,CAAC,MAAM,IAAI,UAAS,CAAC,EAAE,CAAC;QACnD,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,SAAS,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;IACxE,CAAC,IAAI,UAAS,CAAC,EAAE,CAAC;QACd,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;IACrB,CAAC,CAAC;aAEc,YAAY,CAAC,GAAG;QAC5B,IAAI,GAAG,IAAI,GAAG,CAAC,UAAU;YAAE,OAAO,GAAG,CAAC;QACtC,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,GAAG,IAAI,IAAI;YAAE,KAAK,IAAI,CAAC,IAAI,GAAG;gBAAE,IAAI,CAAC,KAAK,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;oBAAE,eAAe,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QACzI,kBAAkB,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;QAChC,OAAO,MAAM,CAAC;IAClB,CAAC;aAEe,eAAe,CAAC,GAAG;QAC/B,OAAO,CAAC,GAAG,IAAI,GAAG,CAAC,UAAU,IAAI,GAAG,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC;IAC5D,CAAC;aAEe,sBAAsB,CAAC,QAAQ,EAAE,UAAU;QACvD,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC3B,MAAM,IAAI,SAAS,CAAC,gDAAgD,CAAC,CAAC;SACzE;QACD,OAAO,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IACpC,CAAC;aAEe,sBAAsB,CAAC,QAAQ,EAAE,UAAU,EAAE,KAAK;QAC9D,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC3B,MAAM,IAAI,SAAS,CAAC,gDAAgD,CAAC,CAAC;SACzE;QACD,UAAU,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAChC,OAAO,KAAK,CAAC;IACjB;;IChOA;QAA8B,4BAAK;QAGlC,kBACiB,eAAiD,EACjD,aAAsB,EACtC,OAAuB;YAAvB,wBAAA,EAAA,UAAU,QAAQ,CAAC,IAAI;YAHxB,YAKC,kBAAM,OAAO,CAAC,SACd;YALgB,qBAAe,GAAf,eAAe,CAAkC;YACjD,mBAAa,GAAb,aAAa,CAAS;;SAItC;QAEM,4BAAmB,GAA1B,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAIC,oBAAiB,CAAC;gBAC5B,KAAK,EAAE,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC;aACvD,CAAC,CAAC;SACH;QAEM,yBAAgB,GAAvB,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAI,UAAU,CAAC,QAAQ,CAAC,IAAI,EAAE;gBACpC,KAAK,EAAE,IAAI,QAAQ,CAAC,OAAO,EAAE,YAAY,CAAC;aAC1C,CAAC,CAAC;SACH;;KA3BF,CAA8B,KAAK;IAC3B,aAAI,GAAG,WAAW,CAAC;IA6B3B;;;IAGA;QAA2C,yCAAQ;QAGlD,+BACiB,eAAiD,EACjD,aAAsB;YAFvC,YAIC,kBAAM,eAAe,EAAE,aAAa,EAAE,qBAAqB,CAAC,IAAI,CAAC,SACjE;YAJgB,qBAAe,GAAf,eAAe,CAAkC;YACjD,mBAAa,GAAb,aAAa,CAAS;;SAGtC;QAEM,yCAAmB,GAA1B,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAIA,oBAAiB,CAAC;gBAC5B,KAAK,EAAE,qBAAqB,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC;aACpE,CAAC,CAAC;SACH;QAEM,sCAAgB,GAAvB,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAI,UAAU,CAAC,qBAAqB,CAAC,IAAI,EAAE;gBACjD,KAAK,EAAE,IAAI,qBAAqB,CAAC,OAAO,EAAE,YAAY,CAAC;aACvD,CAAC,CAAC;SACH;;KA1BF,CAA2C,QAAQ;IAC3C,0BAAI,GAAG,0BAA0B,CAAC;IA4B1C;;;IAGA;QAA4C,0CAAQ;QAGnD,gCACiB,eAAiD,EACjD,aAAsB;YAFvC,YAIC,kBAAM,eAAe,EAAE,aAAa,EAAE,sBAAsB,CAAC,IAAI,CAAC,SAClE;YAJgB,qBAAe,GAAf,eAAe,CAAkC;YACjD,mBAAa,GAAb,aAAa,CAAS;;SAGtC;QAEM,0CAAmB,GAA1B,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAIA,oBAAiB,CAAC;gBAC5B,KAAK,EAAE,sBAAsB,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY,CAAC;aACrE,CAAC,CAAC;SACH;QAEM,uCAAgB,GAAvB,UACC,OAAyC,EACzC,YAAqB;YAErB,OAAO,IAAI,UAAU,CAAC,sBAAsB,CAAC,IAAI,EAAE;gBAClD,KAAK,EAAE,IAAI,sBAAsB,CAAC,OAAO,EAAE,YAAY,CAAC;aACxD,CAAC,CAAC;SACH;;KA1BF,CAA4C,QAAQ;IAC5C,2BAAI,GAAG,2BAA2B;;aCpE1B,YAAY,CAAI,CAAuB;QACtD,OAAO,CAAC,KAAK,SAAS,IAAI,CAAC,KAAK,IAAI,CAAC;IACtC;;aCFgB,QAAQ,CAAC,UAAmB;QAC3C,OAAO,OAAO,UAAU,KAAK,QAAQ,CAAC;IACvC;;ICEA;;;;;;aAMgB,gBAAgB,CAC/B,uBAAsD,EACtD,KAAQ,EACR,MAAe,EACf,kBAA8E;QAE9E,IAAI,QAAQ,CAAC,uBAAuB,CAAC,EAAE;YACtC,IAAI,MAAM,EAAE;gBACX,IAAI,WAAW,GAAG,kBAAkB,CAAC;gBACrC,IAAI,OAAO,kBAAkB,KAAK,UAAU,EAAE;oBAC7C,WAAW,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC;iBACxC;gBAED,MAAM,CAAC,QAAQ,CAAC,CAAC,uBAAuB,CAAC,EAAE;oBAC1C,WAAW,aAAA;iBACX,CAAC,CAAC;aACH;iBAAM;;gBAEN,MAAM,IAAI,KAAK,CACd,mCAAmC;oBAClC,8CAA8C;oBAC9C,8CAA8C;oBAC9C,0CAA0C,CAC3C,CAAC;aACF;SACD;aAAM;YACN,uBAAuB,CAAC,KAAK,CAAC,CAAC;SAC/B;IACF;;aC3BgB,cAAc,CAC7B,YAMmF,EACnF,gBAAkC,EAClC,uBAAkF,EAClF,MAAe;;QAEf,IAAM,KAAK,SACV,YAAY,CAAC,KAAK,0CAAE,KAAK,CAAC;QAE3B,IAAI,KAAK,YAAY,qBAAqB,IAAI,KAAK,YAAY,sBAAsB,EAAE;YACtF,IAAI,uBAAuB,IAAI,YAAY,CAAC,uBAAuB,CAAC,SAAS,CAAC,EAAE;gBAC/E,gBAAgB,CACf,uBAAuB,CAAC,SAAS,EACjC,KAAK,EACL,MAAM,EACN,uBAAuB,CAAC,2BAA2B,CACnD,CAAC;aACF;;YAED,OAAOC,eAAU,CAAC,KAAK,CAAC,CAAC;SACzB;aAAM,IAAI,KAAK,YAAY,QAAQ,EAAE;YACrC,IAAI,YAAY,CAAC,gBAAgB,CAAC,SAAS,CAAC,EAAE;gBAC7C,gBAAgB,CACf,gBAAgB,CAAC,SAAS,EAC1B,KAAK,EACL,MAAM,EACN,gBAAgB,CAAC,2BAA2B,CAC5C,CAAC;aACF;YACD,OAAOA,eAAU,CAAC,KAAK,CAAC,CAAC;SACzB;aAAM;;YAEN,OAAOA,eAAU,CAAC,YAAY,CAAC,CAAC;SAChC;IACF;;aCnDgB,UAAU,CAAS,OAAgB;QAClD,OAAO,OAAO,OAAO,KAAK,UAAU,CAAC;IACtC;;ICFA;;;;;aAKgB,SAAS,CAAI,WAAoB;QAChD,QACC,WAAW;YACX,OAAQ,WAA0B,CAAC,IAAI,KAAK,UAAU;YACtD,OAAQ,WAA0B,CAAC,KAAK,KAAK,UAAU,EACtD;IACH;;ICNA;;;;aAIgB,cAAc,CAC7B,QAAiF;QAEjF,IAAIC,iBAAY,CAAC,QAAQ,CAAC,EAAE;YAC3B,OAAO,QAAQ,CAAC;SAChB;aAAM,IAAI,UAAU,CAAC,QAAQ,CAAC,EAAE;YAChC,OAAOC,OAAE,CAAC,IAAI,CAAC,CAAC,IAAI,CACnBC,mBAAS,CAAC;gBACT,IAAM,MAAM,GAAG,QAAQ,EAAE,CAAC;gBAC1B,IAAIF,iBAAY,CAAC,MAAM,CAAC;oBAAE,OAAO,MAAM,CAAC;gBACxC,IAAI,SAAS,CAAC,MAAM,CAAC;oBAAE,OAAOG,SAAI,CAAC,MAAM,CAAC,CAAC;;oBACtC,OAAOF,OAAE,CAAC,MAAM,CAAC,CAAC;aACvB,CAAC,CACF,CAAC;SACF;aAAM,IAAI,SAAS,CAAC,QAAQ,CAAC,EAAE;YAC/B,OAAOE,SAAI,CAAC,QAAQ,CAAC,CAAC;SACtB;aAAM;YACN,OAAOF,OAAE,CAAC,QAAQ,CAAC,CAAC;SACpB;IACF;;ICzBA;;;;;;;IAOO,IAAM,gCAAgC,GAAG,UAAC,SAAiB;;QAEjE,IAAI,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC,EAAE;YACzC,OAAOA,OAAE,CAAC,IAAI,CAAC,CAAC;SAChB;aAAM;;YAEN,OAAOG,UAAK,CAACH,OAAE,CAAC,KAAK,CAAC,EAAEI,UAAK,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAACC,eAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SACtE;IACF,CAAC;;ICfD;;;;;;;;IAQO,IAAM,oCAAoC,GAAG,UACnD,aAAqB;QAErB,OAAO,gCAAgC,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC;IAC3E,CAAC;;ICZD;;;;;aAKgB,2BAA2B,CAC1C,eAAgC,EAChC,KAAwB;;QAExB,IAAM,aAAa,GAAG,UAAC,IAAY,IAAK,OAAA,IAAI,KAAK,KAAK,CAAC,MAAM,GAAA,CAAC;QAC9D,IAAM,2BAA2B,eAChC,eAAe,CAAC,kBAAkB,0CAAE,IAAI,CAAC,aAAa,oCAAK,IAAI,CAAC;QAEjE,IAAM,2BAA2B,GAAG,QAAC,eAAe,CAAC,kBAAkB,0CAAE,IAAI,CAAC,aAAa,EAAC,CAAC;QAE7F,OAAO,2BAA2B,IAAI,2BAA2B,CAAC;IACnE;;aCjBgB,gBAAgB,CAAc,YAA2B;QACxE,IAAI,MAAM,CAAC;QACX,IAAI,UAAU,CAAI,YAAY,CAAC,EAAE;YAChC,MAAM,GAAG,YAAY,EAAE,CAAC;SACxB;aAAM;YACN,MAAM,GAAG,YAAY,CAAC;SACtB;QACD,OAAO,MAAM,CAAC;IACf;;aCRgB,cAAc,CAAI,SAAuB;QACxD,OAAO,SAAS,CAAC,IAAI,KAAKC,gBAAa,CAAC,QAAQ,CAAC;IAClD;;aCMgB,YAAY,CAC3B,IAAiB,EACjB,WAAgB,EAChB,uBAA0D,EAC1D,OAAmD,EACnD,cAAwE;;QAExE,IAAM,cAAc,GAAG,IAAIC,cAAW,OACrC,uBAAuB,CAAC,MAAM,mCAAI,MAAM,EACxC,uBAAuB,CAAC,UAAU,EAClC,WAAW,EACX,gBAAgB,CAAC,uBAAuB,CAAC,sBAAsB,CAAC,CAChE,CAAC;QAEF,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CACtCC,gBAAM,CAAC,cAAc,CAAC,EACtBC,aAAG,CAAC,UAAC,QAAQ,IAAK,OAAA,uBAAuB,CAAC,wBAAwB,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAA,CAAC,EAClFC,aAAG,CAAC,UAAC,eAAe,IAAK,OAAA,uBAAuB,CAAC,kBAAkB,CAAC,eAAe,CAAC,GAAA,CAAC,EACrFC,kBAAQ,CAAC,UAAC,eAAe,IAAK,OAAA,cAAc,CAAC,eAAe,CAAC,GAAA,CAAC,EAC9DC,oBAAU,CAAC,OAAO,CAAC,CACnB,CAAC;IACH;;aCpBgB,aAAa,CAC5B,IAAiB,EACjB,aAAyC,EACzC,uBAA0D,EAC1D,OAAmD,EACnD,cAAwE;QAExE,IAAM,gBAAgB,GACrB,OAAO,aAAa,KAAK,QAAQ;YACjC,2BAA2B,CAAC,uBAAuB,EAAE,aAAa,CAAC,CAAC;QACrE,IAAI,gBAAgB,EAAE;YACrB,OAAO,cAAc,CAAC,uBAAuB,CAAC,wBAAwB,CAAC,CAAC,IAAI,CAC3EC,cAAI,CAAC,CAAC,CAAC,EACPZ,mBAAS,CAAC,UAAC,WAAW;gBACrB,IAAI,WAAW,EAAE;oBAChB,OAAO,YAAY,CAClB,IAAI,EACJ,WAAW,EACX,uBAAuB,EACvB,OAAO,EACP,cAAc,CACd,CAAC;iBACF;qBAAM;oBACN,OAAOH,eAAU,CAAC,aAAa,CAAC,CAAC;iBACjC;aACD,CAAC,CACF,CAAC;SACF;;YAAM,OAAOA,eAAU,CAAC,aAAa,CAAC,CAAC;IACzC;;IClCA;;;;IAIO,IAAM,oBAAoB,GAAG,UAA8B,GAAiB;QAClF,IAAI;YACH,OAAO,IAAI,CAAC,KAAK,CAACgB,eAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;SACtC;QAAC,OAAO,KAAK,EAAE;YACf,OAAO,CAAC,KAAK,CAAC,gCAAgC,EAAE,KAAK,CAAC,CAAC;YACvD,OAAO,IAAI,CAAC;SACZ;IACF,CAAC;;;QCqDA,kBACQ,MAAsB,EACtB,OAAiC,EACjC,SAAiB;YAFjB,WAAM,GAAN,MAAM,CAAgB;YACtB,YAAO,GAAP,OAAO,CAA0B;YACjC,cAAS,GAAT,SAAS,CAAQ;SACrB;QAGU,aAAI,GAAX,UACN,KAAqB;YAErB,IAAM,iBAAiB,GAAG,QAAQ,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;YAC3D,IAAI,CAAC,iBAAiB;gBAAE,OAAO,IAAI,CAAC;YAEpC,IAAM,MAAM,GAAG,oBAAoB,CAAiB,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1E,IAAM,OAAO,GAAG,oBAAoB,CAA2B,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;YACrF,IAAM,SAAS,GAAGA,eAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;YACtD,IAAI,CAAC,MAAM,IAAI,CAAC,OAAO,IAAI,CAAC,SAAS;gBAAE,OAAO,IAAI,CAAC;YAEnD,OAAO,IAAI,QAAQ,CAAS,MAAM,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;SACxD;QAEa,oBAAW,GAAlB,UAAmB,cAAsB,EAAE,MAAe;YAChE,OAAO,cAAc,CAAC,SAAS,CAAC,CAAC,MAAM,aAAN,MAAM,cAAN,MAAM,GAAI,EAAE,EAAE,MAAM,CAAC,CAAC;SACvD;QAEa,yBAAgB,GAAvB,UACN,KAAqB,EACrB,SAAgD;YAAhD,0BAAA,EAAA,YAAoB,QAAQ,CAAC,mBAAmB;YAEhD,IAAM,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;YACnC,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE;gBACrB,OAAO,IAAI,CAAC;aACZ;YACD,OAAO,GAAiD,CAAC;SACzD;QAEM,4BAAS,GAAT;YACN,OAAO,sBAAsB,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;SAChD;;;IAjCa,4BAAmB,GAAG,GAAG;;QCnE3B,uBAAuB,GAAG,IAAIC,iBAAc,CACxD,uBAAuB,EACtB;QAEW,+BAA+B,GAAG,IAAIA,iBAAc,CAChE,8BAA8B,EAC7B;QAEW,+BAA+B,GAAG,IAAIA,iBAAc,CAE/D,8BAA8B,EAAE;QAErB,uCAAuC,GAAG,IAAIA,iBAAc,CAEvE,qCAAqC;;;QCYtC,yBACkB,WAAwB,EAExB,SAA2B,EAE3B,gBAAkC,EAGlC,uBAGhB,EAGgB,gBAGhB,EAC4B,MAAe;;YAjB3B,gBAAW,GAAX,WAAW,CAAa;YAExB,cAAS,GAAT,SAAS,CAAkB;YAE3B,qBAAgB,GAAhB,gBAAgB,CAAkB;YAGlC,4BAAuB,GAAvB,uBAAuB,CAGvC;YAGgB,qBAAgB,GAAhB,gBAAgB,CAGhC;YAC4B,WAAM,GAAN,MAAM,CAAS;YAE7B,WAAM,mCAClB,IAAI,CAAC,gBAAgB,GACrB,IAAI,CAAC,SAAS,EAChB;YAEc,kBAAa,GAC5B,IAAI,CAAC,uBAAuB,IAAI,IAAI,CAAC,gBAAgB;kDAE/C,IAAI,CAAC,uBAAuB,GAC5B,IAAI,CAAC,gBAAgB,IAExB,SAAS,CAAC;;;;YAKE,oBAAe,GAAG,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAEvD,qBAAgB,GAAG,OAAA,IAAI,CAAC,aAAa,0CAAE,eAAe,IACnE,cAAc,CAAC,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC;kBAClDf,OAAE,CAAC,IAAI,CAAC,CAAC;YAEI,iBAAY,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CACvDS,aAAG,CAAC,UAAC,KAAK;gBACT,IAAI,QAAQ,CAAC,KAAK,CAAC,EAAE;oBACpB,IAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAS,KAAK,CAAC,CAAC;oBAC9C,IAAI,CAAC,QAAQ;wBAAE,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;;wBACtD,OAAO,QAAQ,CAAC;iBACrB;;oBAAM,OAAO,IAAI,CAAC;aACnB,CAAC,CACF,CAAC;YAEc,kBAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CACzDA,aAAG,CAAC,UAAC,YAAY;gBAChB,IAAI,QAAQ,CAAC,YAAY,CAAC,EAAE;oBAC3B,IAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAgB,YAAY,CAAC,CAAC;oBAC5D,IAAI,CAAC,QAAQ;wBAAE,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;;wBACtD,OAAO,QAAQ,CAAC;iBACrB;;oBAAM,OAAO,IAAI,CAAC;aACnB,CAAC,CACF,CAAC;YAEc,uBAAkB,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAC1DA,aAAG,CAAC,UAAC,KAAK,yBAAK,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,MAAM,mCAAI,IAAI,GAAA,CAAC,CACrC,CAAC;YAEc,wBAAmB,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAC3DA,aAAG,CAAC,UAAC,KAAK,yBAAK,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,OAAO,mCAAI,IAAI,GAAA,CAAC,CACtC,CAAC;YAEc,wBAAmB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAC5DA,aAAG,CAAC,UAAC,KAAK,yBAAK,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,MAAM,mCAAI,IAAI,GAAA,CAAC,CACrC,CAAC;YAEc,yBAAoB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAC7DA,aAAG,CAAC,UAAC,KAAK,yBAAK,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,OAAO,mCAAI,IAAI,GAAA,CAAC,CACtC,CAAC;YAEc,0BAAqB,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAC7DR,mBAAS,CAAC,UAAC,KAAK,IACf,OAAA,KAAK,GAAG,oCAAoC,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAGD,OAAE,CAAC,IAAI,CAAC,GAAA,CAC1E,CACD,CAAC;YAEc,2BAAsB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAC/DC,mBAAS,CAAC,UAAC,KAAK,IACf,OAAA,KAAK,GAAG,oCAAoC,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAGD,OAAE,CAAC,IAAI,CAAC,GAAA,CAC1E,CACD,CAAC;YAEc,wBAAmB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CACpES,aAAG,CAAC,UAAC,SAAS,IAAK,OAAA,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,GAAA,CAAC,CACzD,CAAC;YAEc,yBAAoB,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CACtEA,aAAG,CAAC,UAAC,SAAS,IAAK,OAAA,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,GAAA,CAAC,CACzD,CAAC;SA7EE;;;;QAkFG,uCAAa,GAAb;YAAA,iBAkBN;YAjBA,IAAI,IAAI,CAAC,aAAa,EAAE;gBACvB,OAAO,aAAa,CACnB,IAAI,CAAC,WAAW,EAChB,4CAA4C,EAC5C,IAAI,CAAC,aAAa,EAClB,UAAC,YAAY,IACZ,OAAA,cAAc,CACb,sBAAsB,CAAC,mBAAmB,CAAC,SAAS,EAAE,YAAY,CAAC,EACnE,KAAI,CAAC,MAAM,EACX,KAAI,CAAC,aAAa,EAClB,KAAI,CAAC,MAAM,CACX,CAAC,IAAI,CAACG,oBAAU,CAAC,cAAM,OAAAZ,OAAE,CAAC,KAAK,CAAC,GAAA,CAAC,CAAC,GAAA,EACpC,cAAM,OAAAA,OAAE,CAAC,IAAI,CAAC,GAAA,CACd,CAAC;aACF;iBAAM;gBACN,OAAOA,OAAE,CAAC,KAAK,CAAC,CAAC;aACjB;SACD;;;;;gBAhIDgB,aAAU,SAAC;oBACX,UAAU,EAAE,MAAM;iBAClB;;;gBA1BQC,cAAW;gDAmCjBC,SAAM,SAAC,uBAAuB;gDAE9BA,SAAM,SAAC,+BAA+B;gDAEtCA,SAAM,SAAC,uCAAuC,cAC9CC,WAAQ;gDAKRD,SAAM,SAAC,+BAA+B,cACtCC,WAAQ;gBA5CFC,SAAM,uBAiDZD,WAAQ;;;;QClBV,oBAAoC,eAAgC;YAAhC,oBAAe,GAAf,eAAe,CAAiB;YAF5D,4BAAuB,GAAG,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,IAAI,CAACN,cAAI,CAAC,CAAC,CAAC,CAAC,CAAC;SAEjB;QAEhE,4BAAO,GAAP,UAAQ,gBAAqC;YAA7C,iBAcP;;YAbA,IAAM,OAAO,SACZ,gBAAgB,aAAhB,gBAAgB,cAAhB,gBAAgB,SAChB,IAAI,CAAC,eAAe,CAAC,aAAa,0CAAE,yCAAyC,mCAC7E,gDAAgD,CAAC;YAClD,OAAO,IAAI,CAAC,uBAAuB,CAAC,IAAI,CACvCZ,mBAAS,CAAC,UAAC,OAAO;gBACjB,IAAI,CAAC,OAAO,IAAI,OAAO,EAAE;oBACxB,OAAO,KAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAC;iBAC5C;qBAAM;oBACN,OAAOD,OAAE,CAAC,OAAO,CAAC,CAAC;iBACnB;aACD,CAAC,CACF,CAAC;SACF;QAEM,gCAAW,GAAX,UACN,KAA6B,EAC7B,MAA2B;YAE3B,IAAM,IAAI,GAAG,KAAK,CAAC,IAAkC,CAAC;YACtD,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,gBAAgB,CAAC,CAAC;SAC5C;QAEM,qCAAgB,GAAhB,UACN,UAAkC,EAClC,MAA2B;YAE3B,IAAM,IAAI,GAAG,UAAU,CAAC,IAAkC,CAAC;YAC3D,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,gBAAgB,CAAC,CAAC;SAC5C;QAEM,4BAAO,GAAP,UACN,KAAY,EACZ,SAAuB;YAEvB,IAAM,IAAI,GAAG,KAAK,CAAC,IAAkC,CAAC;YACtD,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,gBAAgB,CAAC,CAAC;SAC5C;;;;;gBA9CDgB,aAAU,SAAC;oBACX,UAAU,EAAE,MAAM;iBAClB;;;gBAfQ,eAAe;;;ICSxB;;;;;QAQC,qCAEC,SAA2B,EAE3B,gBAAkC,EAGlC,aAAyD,EAGzD,uBAAmE,EACtC,MAAe;YAAf,WAAM,GAAN,MAAM,CAAS;YAE5C,IAAI,CAAC,gBAAgB,mCACjB,gBAAgB,GAChB,SAAS,CACZ,CAAC;YAEF,IAAI,CAAC,uBAAuB;gBAC3B,uBAAuB,IAAI,aAAa;sDAElC,uBAAuB,GACvB,aAAa,IAEhB,SAAS,CAAC;SACd;QACM,+CAAS,GAAT,UACN,OAA6B,EAC7B,IAAiB;YAFX,iBAgBN;YAZA,OAAO,IAAI;iBACT,MAAM,CAAC,OAAO,CAAC;iBACf,IAAI,CACJJ,oBAAU,CAAC,UAAC,aAAgC,IAC3C,OAAA,cAAc,CACb,aAAa,EACb,KAAI,CAAC,gBAAgB,EACrB,KAAI,CAAC,uBAAuB,EAC5B,KAAI,CAAC,MAAM,CACX,GAAA,CACD,CACD,CAAC;SACH;;;;gBA9CDI,aAAU;;;gDAKRE,SAAM,SAAC,uBAAuB;gDAE9BA,SAAM,SAAC,+BAA+B;gDAEtCC,WAAQ,YACRD,SAAM,SAAC,+BAA+B;gDAEtCC,WAAQ,YACRD,SAAM,SAAC,uCAAuC;gBAhCxCE,SAAM,uBAkCZD,WAAQ;;;ICxCJ,IAAM,SAAS,GAAG,UAAC,IAAqB,EAAE,OAAuB;QACvE,IAAI,QAAQ,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,KAAK,OAAO,CAAC;aACvC,IAAI,OAAO;YAAE,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;YACvC,OAAO,KAAK,CAAC;IACnB,CAAC,CAAC;IAEF;;;;IAIO,IAAM,YAAY,GAAG,UAAC,OAAuB,EAAE,OAAe;QAAf,wBAAA,EAAA,eAAe;QAAK,OAAA,UACzE,IAAqB,IACR,QAAC,OAAO,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,SAAS,CAAC,IAAI,EAAE,OAAO,CAAC,IAAC;IAFJ,CAEI;;ICV9E;;;;;aAKgB,qBAAqB,CACpC,SAAoB,EACpB,EAAwC;YAAtC,MAAM,YAAA,EAAE,IAAI,UAAA,EAAE,QAAQ,cAAA;;QAExB,IAAM,eAAe,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;QAC/C,IAAM,aAAa,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC;QAC3C,IAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QAEvC,IAAM,0BAA0B,eAAG,SAAS,CAAC,iBAAiB,0CAAE,IAAI,CAAC,eAAe,oCAAK,IAAI,CAAC;QAE9F,IAAM,0BAA0B,GAAG,QAAC,SAAS,CAAC,iBAAiB,0CAAE,IAAI,CAAC,eAAe,EAAC,CAAC;QAEvF,IAAM,wBAAwB,eAAG,SAAS,CAAC,eAAe,0CAAE,IAAI,CAAC,aAAa,oCAAK,IAAI,CAAC;QAExF,IAAM,wBAAwB,GAAG,QAAC,SAAS,CAAC,eAAe,0CAAE,IAAI,CAAC,aAAa,EAAC,CAAC;QAEjF,IAAM,sBAAsB,eAAG,SAAS,CAAC,aAAa,0CAAE,IAAI,CAAC,WAAW,oCAAK,IAAI,CAAC;QAElF,IAAM,sBAAsB,GAAG,QAAC,SAAS,CAAC,aAAa,0CAAE,IAAI,CAAC,WAAW,EAAC,CAAC;QAE3E,QACC,0BAA0B;YAC1B,0BAA0B;YAC1B,wBAAwB;YACxB,wBAAwB;YACxB,sBAAsB;YACtB,sBAAsB,EACrB;IACH;;ICXA;;;;;aAKgB,WAAW,CAAC,GAAY;QACvC,IAAM,QAAQ,GAAG,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,KAAK,CAAC,mCAAmC,CAAC,CAAC;QACjE,OAAO;YACN,QAAQ,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAgB;YACtC,MAAM,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAc;YAClC,IAAI,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAY;SAC9B,CAAC;IACH;;;QCbC,gCAEC,SAA2B,EAE3B,gBAAkC,EAGlC,aAAyD,EAGzD,uBAAmE;YAEnE,IAAI,CAAC,gBAAgB,mCACjB,gBAAgB,GAChB,SAAS,CACZ,CAAC;YAEF,IAAI,CAAC,uBAAuB,GAAG,aAAa;gBAC3C,uBAAuB,oCACnB,uBAAuB,GACvB,aAAa,CAChB,CAAC;SACH;QAEM,0CAAS,GAAT,UACN,OAA6B,EAC7B,IAAiB;YAFX,iBAyCN;YArCA,IAAM,YAAY,GAAG,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC9C,OAAO,cAAc,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,IAAI,CACzDN,cAAI,CAAC,CAAC,CAAC,EACPZ,mBAAS,CAAC,UAAC,QAAQ;gBAClB,IAAI,qBAAqB,CAAC,KAAI,CAAC,gBAAgB,EAAE,YAAY,CAAC,EAAE;oBAC/D,IAAM,KAAK,GAAG,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAClD,IAAM,6BAA6B,GAAG,CAAC,KAAK,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC;;oBAElE,IACC,QAAQ;yBACP,CAAC,6BAA6B,IAAI,KAAI,CAAC,uBAAuB,CAAC,EAC/D;wBACD,IAAI,MAAM,GAAG,OAAO,CAAC,KAAK,CAAC;4BAC1B,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,GAAG,CAC3B,KAAI,CAAC,gBAAgB,CAAC,MAAM,EAC5B,KAAI,CAAC,gBAAgB,CAAC,MAAM;kCACzB,KAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,QAAQ;kCACvC,QAAQ,CACX;yBACD,CAAC,CAAC;wBACH,IAAI,KAAI,CAAC,gBAAgB,CAAC,qBAAqB,EAAE;4BAChD,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC;gCACrB,eAAe,EAAE,IAAI;6BACrB,CAAC,CAAC;yBACH;wBACD,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;qBAC3B;yBAAM;wBACN,OAAOH,eAAU,CAChB,QAAQ,CAAC,mBAAmB,CAC3B,OAAO,EACP,6DAA6D,CAC7D,CACD,CAAC;qBACF;iBACD;;oBAAM,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;aACnC,CAAC,CACF,CAAC;SACF;;;;gBAtEDkB,aAAU;;;gDAMRE,SAAM,SAAC,uBAAuB;gDAE9BA,SAAM,SAAC,+BAA+B;gDAEtCC,WAAQ,YACRD,SAAM,SAAC,+BAA+B;gDAEtCC,WAAQ,YACRD,SAAM,SAAC,uCAAuC;;;;QCChD,+BAEC,SAA2B,EAE3B,gBAAkC,EAElC,aAAwD,EAExD,uBAAkE;;YAElE,IAAI,CAAC,gBAAgB,mCACjB,gBAAgB,GAChB,SAAS,CACZ,CAAC;YAEF,IAAI,CAAC,uBAAuB,mCACxB,uBAAuB,GACvB,aAAa,CAChB,CAAC;YAEF,IAAI,CAAC,gBAAgB,GAAG,cAAc,OACrC,IAAI,CAAC,uBAAuB,CAAC,eAAe,oCAAK,cAAM,OAAA,IAAI,GAAA,CAAC,CAC5D,CAAC;YAEF,IAAI,CAAC,gCAAgC,GAAG,CAAC,CAAC,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC;SACvF;QAEM,yCAAS,GAAT,UACN,OAA6B,EAC7B,IAAiB;YAFX,iBAkFN;YA9EA,IAAM,YAAY,GAAG,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC9C,IAAM,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;;;;;;;YAQzE,IACC,cAAc;gBACd,CAAC,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,uBAAuB,CAAC,UAAU,CAAC;gBACnE,qBAAqB,CAAC,IAAI,CAAC,uBAAuB,EAAE,YAAY,CAAC,EAChE;gBACD,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAChCL,cAAI,CAAC,CAAC,CAAC,EACPZ,mBAAS,CAAC,UAAC,eAAe;oBACzB,IAAM,QAAQ,GAAG,QAAQ,CAAC,WAAW,CACpC,cAAc,EACd,KAAI,CAAC,gBAAgB,CAAC,MAAM,CAC5B,CAAC;oBACF,IAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBACtC,IAAM,YAAY,GAAG,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC;oBAC7E,IAAM,6BAA6B,GAAG,CAAC,KAAK,IAAI,KAAK,CAAC,SAAS,EAAE,CAAC;oBAClE,IAAM,8BAA8B,GACnC,CAAC,YAAY,IAAI,YAAY,CAAC,SAAS,EAAE,CAAC;;oBAE3C,IACC,6BAA6B;wBAC7B,KAAI,CAAC,gCAAgC;wBACrC,8BAA8B,EAC7B;wBACD,OAAOH,eAAU,CAChB,qBAAqB,CAAC,mBAAmB,CACxC,OAAO,EACP,4CAA4C,CAC5C,CACD,CAAC;qBACF;;oBAGD,OAAO,CAAC,6BAA6B;;4BAElCA,eAAU,CAAC,8BAA8B,CAAC;;4BAE1C,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EACrB,IAAI,CACLc,oBAAU,CAAC,UAAC,KAAiC;;;wBAI5C,OAAO,aAAa,CACnB,IAAI,EACJ,KAAK,EACL,KAAI,CAAC,uBAAuB,EAC5B,UAAC,YAAY,IACZ,OAAAd,eAAU,CACT,sBAAsB,CAAC,mBAAmB,CACzC,OAAO,EACP,YAAY,CACZ,CACD,GAAA,EACF,UAAC,eAAe;4BACf,IAAM,wBAAwB,GAAG,OAAO,CAAC,KAAK,CAAC;gCAC9C,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,GAAG,CAC3B,KAAI,CAAC,gBAAgB,CAAC,MAAM,EAC5B,KAAI,CAAC,gBAAgB,CAAC,MAAM;oCAC3B,eAAe,CAAC,WAAW,CAC5B;6BACD,CAAC,CAAC;4BACH,OAAO,IAAI,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC;yBAC7C,CACD,CAAC;qBACF,CAAC,CACF,CAAC;iBACF,CAAC,CACF,CAAC;aACF;;gBAAM,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;SACnC;;;;gBApHDkB,aAAU;;;gDAQRE,SAAM,SAAC,uBAAuB;gDAE9BA,SAAM,SAAC,+BAA+B;gDAEtCA,SAAM,SAAC,+BAA+B;gDAEtCA,SAAM,SAAC,uCAAuC;;;ICrBjD;;;;;aAKgB,8BAA8B,CAC7C,0BAA0D;QAE1D,OAAO,gBACN,OAAO,EAAE,uBAAuB,EAChC,KAAK,EAAE,KAAK,IACT,0BAA0B,CACD,CAAC;IAC/B,CAAC;IAED;;;;;aAKgB,qCAAqC,CACpD,iCAGC;QAED,OAAO,gBACN,OAAO,EAAE,+BAA+B,EACxC,KAAK,EAAE,KAAK,IACT,iCAAiC,CACgC,CAAC;IACvE,CAAC;IAED;;;;;;;;QAUA;;QA8Be,iBAAO,GAAd,UACN,8BAA8D,EAC9D,+BAGC;YAED,OAAO;gBACN,QAAQ,EAAE,SAAS;gBACnB,SAAS;oBACR;wBACC,OAAO,EAAEG,oBAAiB;wBAC1B,QAAQ,EAAE,2BAA2B;wBACrC,KAAK,EAAE,IAAI;qBACX;oBACD;wBACC,OAAO,EAAEA,oBAAiB;wBAC1B,QAAQ,EAAE,sBAAsB;wBAChC,KAAK,EAAE,IAAI;qBACX;oBACD;wBACC,OAAO,EAAE,+BAA+B;wBACxC,QAAQ,EAAE,kBAAkB;qBAC5B;oBACD,8BAA8B,CAAC,8BAA8B,CAAC;oBAC1D,+BAA+B;sBAChC;wBACA;4BACC,OAAO,EAAEA,oBAAiB;4BAC1B,QAAQ,EAAE,qBAAqB;4BAC/B,KAAK,EAAE,IAAI;yBACX;wBACD;4BACC,OAAO,EAAE,uCAAuC;4BAChD,QAAQ,EAAE,0BAA0B;yBACpC;wBACD,qCAAqC,CACpC,+BAA+B,CAC/B;qBACA;sBACD,EAAE,EACL;aACD,CAAC;SACF;;;;gBA5EDC,WAAQ,SAAC;oBACT,OAAO,EAAE,CAACC,mBAAY,CAAC;iBACvB;;;IC/DD,WAAY,UAAU;QACrB,yBAAW,CAAA;QACX,2BAAa,CAAA;QACb,2BAAa,CAAA;QACb,yBAAW,CAAA;QACX,+BAAiB,CAAA;QACjB,iCAAmB,CAAA;QACnB,iCAAmB,CAAA;QACnB,6BAAe,CAAA;QACf,6BAAe,CAAA;IAChB,CAAC,EAVWC,kBAAU,KAAVA,kBAAU;;ICAtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}