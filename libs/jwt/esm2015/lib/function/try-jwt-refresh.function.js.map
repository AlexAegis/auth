{"version":3,"file":"try-jwt-refresh.function.js","sourceRoot":"/home/runner/work/auth/auth/libs/jwt/src/","sources":["lib/function/try-jwt-refresh.function.ts"],"names":[],"mappings":"AACA,OAAO,EAAc,UAAU,EAAE,MAAM,MAAM,CAAC;AAC9C,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAC;AAKjD,OAAO,EAAE,2BAA2B,EAAE,MAAM,4CAA4C,CAAC;AACzF,OAAO,EAAE,YAAY,EAAE,MAAM,2BAA2B,CAAC;AACzD,OAAO,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAE5D,MAAM,UAAU,aAAa,CAC5B,IAAiB,EACjB,aAAyC,EACzC,uBAA0D,EAC1D,OAAmD,EACnD,cAAwE;IAExE,MAAM,gBAAgB,GACrB,OAAO,aAAa,KAAK,QAAQ;QACjC,2BAA2B,CAAC,uBAAuB,EAAE,aAAa,CAAC,CAAC;IACrE,IAAI,gBAAgB,EAAE;QACrB,OAAO,cAAc,CAAC,uBAAuB,CAAC,wBAAwB,CAAC,CAAC,IAAI,CAC3E,IAAI,CAAC,CAAC,CAAC,EACP,SAAS,CAAC,CAAC,WAAW,EAAE,EAAE,CACzB,YAAY,CAAC,IAAI,EAAE,WAAW,EAAE,uBAAuB,EAAE,OAAO,EAAE,cAAc,CAAC,CACjF,CACD,CAAC;KACF;;QAAM,OAAO,UAAU,CAAC,aAAa,CAAC,CAAC;AACzC,CAAC","sourcesContent":["import { HttpErrorResponse, HttpHandler } from '@angular/common/http';\nimport { Observable, throwError } from 'rxjs';\nimport { switchMap, take } from 'rxjs/operators';\nimport {\n\tJwtRefreshConfiguration,\n\tJwtRefreshResponse,\n} from '../model/auth-core-configuration.interface';\nimport { checkAgainstHttpErrorFilter } from './check-against-http-error-filter.function';\nimport { doJwtRefresh } from './do-jwt-refresh.function';\nimport { intoObservable } from './into-observable.function';\n\nexport function tryJwtRefresh<Req, Res, Ret>(\n\tnext: HttpHandler,\n\toriginalError: string | HttpErrorResponse,\n\tjwtRefreshConfiguration: JwtRefreshConfiguration<Req, Res>,\n\tonError: (refreshError: unknown) => Observable<Ret>,\n\toriginalAction: (refreshResponse: JwtRefreshResponse) => Observable<Ret>\n): Observable<Ret> {\n\tconst isRefreshAllowed =\n\t\ttypeof originalError === 'string' ||\n\t\tcheckAgainstHttpErrorFilter(jwtRefreshConfiguration, originalError);\n\tif (isRefreshAllowed) {\n\t\treturn intoObservable(jwtRefreshConfiguration.createRefreshRequestBody).pipe(\n\t\t\ttake(1),\n\t\t\tswitchMap((requestBody) =>\n\t\t\t\tdoJwtRefresh(next, requestBody, jwtRefreshConfiguration, onError, originalAction)\n\t\t\t)\n\t\t);\n\t} else return throwError(originalError);\n}\n"]}